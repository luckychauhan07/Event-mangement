<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Event Ease ‚Äî My Registrations (Student)</title>

		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="../style.css" />

		<style>
			body {
				font-family: Inter, system-ui, Arial;
				background: var(--bg-light);
				color: var(--text-dark);
			}
			.app-shell {
				display: flex;
				min-height: calc(100vh - var(--header-height));
			}
			.app-sidebar {
				width: var(--sidebar-width);
				background: linear-gradient(
					180deg,
					var(--sidebar-gradient-start),
					var(--sidebar-gradient-end)
				);
				color: #fff;
				padding: 28px 20px;
				display: flex;
				flex-direction: column;
				box-shadow: var(--shadow-md);
			}
			.app-main {
				flex: 1;
				padding: 32px;
			}
			.card-compact {
				background: var(--bg-surface);
				border-radius: 10px;
				padding: 16px;
				border: 1px solid var(--border);
			}
			.status-box {
				padding: 8px 16px;
				border-radius: 8px;
				font-size: 14px;
				font-weight: 700;
				text-transform: uppercase;
				display: inline-block;
				min-width: 140px;
				text-align: center;
			}

			.status-approved {
				background-color: #198754;
				color: white;
			}

			.status-pending {
				background-color: #ffc107;
				color: #000;
			}

			.status-cancelled {
				background-color: #dc3545;
				color: white;
			}

			/* Team info styling */
			.team-box {
				font-size: 14px;
				font-weight: 600;
				padding: 6px 10px;
				border-radius: 6px;
				background: #f1f3f5;
				display: inline-block;
			}

			.muted {
				color: var(--text-muted);
			}
			@media (max-width: 900px) {
				.app-sidebar {
					display: none;
				}
				.app-main {
					padding: 24px;
				}
			}
		</style>
	</head>
	<body>
		<header class="topbar">
			<a
				href="user-home.html"
				class="d-flex align-items-center text-decoration-none"
			>
				<div class="logo-mark">EE</div>
				<div
					style="
						margin-left: 10px;
						font-weight: 700;
						color: var(--text-dark);
					"
				>
					Event Ease
				</div>
			</a>
			<div class="d-flex align-items-center gap-3">
				<input
					id="searchUserTop"
					class="form-control form-control-sm d-none d-md-block"
					placeholder="Search events..."
					style="min-width: 260px"
				/>
				<div class="dropdown">
					<button
						class="btn d-flex align-items-center gap-2"
						data-bs-toggle="dropdown"
					>
						<div
							class="rounded-circle bg-primary text-white"
							style="
								width: 36px;
								height: 36px;
								display: grid;
								place-items: center;
							"
						>
							ST
						</div>
						<div class="d-none d-md-block text-start">
							<div style="font-weight: 600">Student</div>
							<div class="muted">you@college.edu</div>
						</div>
					</button>
					<ul class="dropdown-menu dropdown-menu-end">
						<li>
							<a class="dropdown-item" href="user-profile.html"
								>Profile</a
							>
						</li>
						<li>
							<a
								class="dropdown-item"
								href="user-registrations.html"
								>My Registrations</a
							>
						</li>
						<li><hr class="dropdown-divider" /></li>
						<li>
							<button
								class="dropdown-item text-danger"
								onclick="userLogout()"
							>
								Logout
							</button>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div class="app-shell">
			<aside class="app-sidebar d-none d-lg-flex">
				<nav class="sidebar-nav">
					<a href="user-home.html">üè† Home</a>
					<a href="user-events.html">üìÖ Browse Events</a>
					<a href="user-registrations.html" class="active"
						>üìã My Registrations</a
					>
					<a
						href="user-notification.html"
						class="text-white-95 p-2 rounded active"
						>üîî Notifications</a
					>
					<a
						href="user-profile.html"
						class="text-white-95 p-2 rounded"
						>üë§ Profile</a
					>
				</nav>
			</aside>

			<main class="app-main">
				<div class="card-compact">
					<h5 class="mb-2">Your registrations</h5>
					<div id="regsList" class="muted small">Loading...</div>
				</div>
			</main>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			/* For demo we reuse the EVENTS array from other pages; make local copy to keep standalone */
			const EVENTS = [
				{
					id: "E101",
					name: "Inter-College Hackathon",
					requiresApproval: true,
				},
				{ id: "E102", name: "Food Fest", requiresApproval: false },
				{ id: "E103", name: "Design Sprint", requiresApproval: false },
			];
			/* registrations persisted here in-memory. In a real app these would be fetched from backend */
			let registrations = [
				{
					regId: "R100",
					eventId: "E101",
					status: "pending",
					createdAt: "2025-11-20T10:00:00Z",
					team: null, // not assigned yet
				},
				{
					regId: "R101",
					eventId: "E102",
					status: "approved",
					createdAt: "2025-11-21T11:00:00Z",
					team: {
						name: "Alpha Squad",
						role: "Member",
					},
				},
			];

			// Add deadline to registrations
			registrations = registrations.map((r) => ({
				...r,
				deadline: r.deadline || "2025-12-16T23:59",
			}));

			function renderRegs() {
				const box = document.getElementById("regsList");
				box.innerHTML = "";

				if (registrations.length === 0) {
					box.innerHTML =
						'<div class="muted">No registrations yet.</div>';
					return;
				}

				registrations.forEach((r) => {
					const e = EVENTS.find((x) => x.id === r.eventId) || {
						name: r.eventId,
					};

					const statusClass =
						r.status === "approved"
							? "status-approved"
							: r.status === "pending"
							? "status-pending"
							: "status-cancelled";

					const row = document.createElement("div");

					/* card-like gap between events */
					row.className =
						"d-flex justify-content-between align-items-center mb-4 p-3 border rounded";

					row.innerHTML = `
		<div>
			<div style="font-weight:600; font-size:16px">
				${e.name}
			</div>

			<div class="muted small mb-2">
				${r.regId} ‚Ä¢ ${new Date(r.createdAt).toLocaleString()}
			</div>

			<!-- STATUS -->
			<div class="status-box ${statusClass} mb-2">
				${r.status}
			</div>

			<!-- TEAM INFO -->
			<div class="team-box">
				Team:
				${r.team ? `${r.team.name} (${r.team.role})` : "Not Assigned"}
			</div>
		</div>

		<div class="text-end">
			<button class="btn btn-sm btn-outline me-2"
				onclick="viewReg('${r.regId}')">
				View
			</button>

			<button
				class="btn btn-sm btn-danger"
				${
					new Date() <= new Date(r.deadline) &&
					r.status !== "cancelled"
						? ""
						: "disabled"
				}
				onclick="withdrawRegistration('${r.regId}')"
			>
				Withdraw
			</button>
		</div>
		`;

					box.appendChild(row);
				});
			}

			function viewReg(regId) {
				const r = registrations.find((x) => x.regId === regId);
				const e = EVENTS.find((x) => x.id === r.eventId);
				alert(
					`${e.name}\nRegistration ID: ${r.regId}\nStatus: ${
						r.status
					}\nRequested: ${new Date(r.createdAt).toLocaleString()}`
				);
			}

			renderRegs();
			function withdrawRegistration(regId) {
				const reg = registrations.find((r) => r.regId === regId);
				if (!reg) return alert("Registration not found");

				// Deadline check
				if (new Date() > new Date(reg.deadline)) {
					return alert("Withdrawal deadline has passed");
				}

				if (
					!confirm(
						"Are you sure you want to withdraw from this event?"
					)
				)
					return;

				// Update status
				reg.status = "cancelled";

				alert("You have successfully withdrawn from the event.");

				renderRegs();
			}
			function userLogout() {
				if (!confirm("Are you sure you want to logout?")) return;

				// Clear user session data (if any)
				localStorage.removeItem("studentSession");
				localStorage.removeItem("studentProfile");

				// Optional: clear everything related to user
				// localStorage.clear();

				alert("You have been logged out successfully.");

				// Redirect to login page (outside user folder)
				window.location.href = "../login.html";
			}
		</script>
	</body>
</html>
