<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Event Ease â€” Browse Events (Student)</title>

		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="../style.css" />

		<style>
			body {
				font-family: Inter, system-ui, Arial;
				background: var(--bg-light);
				color: var(--text-dark);
			}
			.app-shell {
				display: flex;
				min-height: calc(100vh - var(--header-height));
			}
			.app-sidebar {
				width: var(--sidebar-width);
				background: linear-gradient(180deg, var(--sidebar-gradient-start), var(--sidebar-gradient-end));
				color: #fff;
				padding: 28px 20px;
				display: flex;
				flex-direction: column;
				box-shadow: var(--shadow-md);
			}
			.app-main {
				flex: 1;
				padding: 32px;
			}
			@media (max-width: 991px) {
				.app-sidebar {
					display: none;
				}
				.app-main {
					padding: 24px;
				}
			}
		</style>
	</head>
	<body>
		<header class="topbar">
			<a
				href="user-home.html"
				class="d-flex align-items-center text-decoration-none"
			>
				<div class="logo-mark">EE</div>
				<div style="margin-left: 10px; font-weight: 700; color: var(--text-dark);">
					Event Ease
				</div>
			</a>
			<div class="d-flex align-items-center gap-3">
				<input
					id="searchUserTop"
					class="form-control form-control-sm d-none d-md-block"
					placeholder="Search events..."
					style="min-width: 260px"
				/>
				<div class="dropdown">
					<button
						class="btn d-flex align-items-center gap-2"
						data-bs-toggle="dropdown"
					>
						<div
							class="rounded-circle bg-primary text-white"
							style="
								width: 36px;
								height: 36px;
								display: grid;
								place-items: center;
							"
						>
							ST
						</div>
						<div class="d-none d-md-block text-start">
							<div style="font-weight: 600">Student</div>
							<div class="muted">you@college.edu</div>
						</div>
					</button>
					<ul class="dropdown-menu dropdown-menu-end">
						<li>
							<a class="dropdown-item" href="user-profile.html"
								>Profile</a
							>
						</li>
						<li>
							<a
								class="dropdown-item"
								href="user-registrations.html"
								>My Registrations</a
							>
						</li>
						<li><hr class="dropdown-divider" /></li>
						<li>
							<button
								class="dropdown-item text-danger"
								onclick="userLogout()"
							>
								Logout
							</button>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div class="app-shell">
			<aside class="app-sidebar d-none d-lg-flex">
				<nav class="sidebar-nav">
					<a href="user-home.html"
						>ğŸ  Home</a
					>
					<a
						href="user-events.html"
						class="active"
						>ğŸ“… Browse Events</a
					>
					<a
						href="user-registrations.html"
						>ğŸ“‹ My Registrations</a
					>
					<a href="user-notification.html" class="text-white-95 p-2 rounded active">ğŸ”” Notifications</a>
				    <a href="user-profile.html" class="text-white-95 p-2 rounded">ğŸ‘¤ Profile</a>
				</nav>
			</aside>

			<main class="app-main">
				<div
					class="d-flex justify-content-between align-items-center mb-3"
				>
					<div>
						<h4 class="mb-0">Browse Events</h4>
						<div class="muted">
							Filters show approval requirement and team settings
						</div>
					</div>
					<div class="d-flex gap-2">
						<select
							id="typeFilter"
							class="form-select form-select-sm"
						>
							<option value="all">All types</option>
							<option value="tech">Tech</option>
							<option value="cultural">Cultural</option>
						</select>
						<select
							id="approvalFilter"
							class="form-select form-select-sm"
						>
							<option value="all">All</option>
							<option value="requires">Requires approval</option>
							<option value="auto">Auto-approved</option>
						</select>
					</div>
				</div>

				<div class="card-compact">
					<div class="table-responsive">
						<table class="table align-middle">
							<thead>
								<tr>
									<th>Event</th>
									<th>Date</th>
									<th>Venue</th>
									<th>Capacity</th>
									<th>Type</th>
									<th class="text-end">Action</th>
								</tr>
							</thead>
							<tbody id="eventsTable"></tbody>
						</table>
					</div>
				</div>
			</main>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
	const EVENTS = [
		{
			id: "E101",
			name: "Inter-College Hackathon",
			date: "2025-12-05T10:00",
			venue: "Auditorium A",
			type: "tech",
			teamParticipation: true,
			requiresApproval: true,
			capacity: 200,
			participants: 120,
		},
		{
			id: "E102",
			name: "Food Fest",
			date: "2025-12-12T16:00",
			venue: "Hall B",
			type: "cultural",
			teamParticipation: false,
			requiresApproval: false,
			capacity: 80,
			participants: 45,
		},
		{
			id: "E103",
			name: "Design Sprint",
			date: "2025-12-10T09:00",
			venue: "Lab 101",
			type: "tech",
			teamParticipation: true,
			requiresApproval: false,
			capacity: 40,
			participants: 22,
		},
	];

	/* SAME student registrations store */
	let registrations = [];

	function render() {
	const tbody = document.getElementById("eventsTable");
	tbody.innerHTML = "";

	const q = (
		document.getElementById("searchUserTop")?.value || ""
	).toLowerCase();
	const tfilter = document.getElementById("typeFilter").value;
	const afilter = document.getElementById("approvalFilter").value;

	EVENTS.filter((e) => {
		if (tfilter !== "all" && e.type !== tfilter) return false;
		if (afilter === "requires" && !e.requiresApproval) return false;
		if (afilter === "auto" && e.requiresApproval) return false;
		if (
			q &&
			!(
				e.name + " " + e.venue + " " + e.id
			).toLowerCase().includes(q)
		)
			return false;
		return true;
	}).forEach((e) => {
		const tr = document.createElement("tr");

		const alreadyRegistered = registrations.some(
			(r) => r.eventId === e.id && r.status !== "cancelled"
		);

		tr.innerHTML = `
			<td style="font-weight:600">
				${e.name}
				<div class="small muted">${e.id}</div>
			</td>
			<td>${new Date(e.date).toLocaleString()}</td>
			<td>${e.venue}</td>
			<td>${e.participants}/${e.capacity}</td>
			<td>
				<span class="badge ${
					e.requiresApproval
						? "bg-warning text-dark"
						: "bg-success"
				}">
					${e.requiresApproval ? "Requires approval" : "Auto"}
				</span>
			</td>
			<td class="text-end">
				<button class="btn btn-sm btn-outline me-1"
					onclick="viewDetails('${e.id}')">
					Details
				</button>
				<button class="btn btn-sm btn-primary"
					${alreadyRegistered ? "disabled" : ""}
					onclick="registerEvent('${e.id}')">
					${
						alreadyRegistered
							? "Registered"
							: e.teamParticipation
							? "Team Register"
							: "Register"
					}
				</button>
			</td>
		`;
		tbody.appendChild(tr);
	});
}

document
	.getElementById("searchUserTop")
	.addEventListener("keydown", (e) => {
		if (e.key === "Enter") render();
	});

	/* DETAILS POPUP (unchanged) */
	function viewDetails(eventId) {
		const e = EVENTS.find((x) => x.id === eventId);
		alert(
			`${e.name}\n${new Date(e.date).toLocaleString()}\nVenue: ${
				e.venue
			}\nTeams: ${
				e.teamParticipation ? "Allowed" : "No"
			}\nApproval: ${
				e.requiresApproval ? "Required" : "None"
			}`
		);
	}

	/* MAIN REGISTRATION LOGIC */
	function registerEvent(eventId) {
		const e = EVENTS.find((x) => x.id === eventId);
		if (!e) return;

		/* ğŸ”’ DUPLICATE CHECK */
		const alreadyRegistered = registrations.some(
			(r) => r.eventId === eventId && r.status !== "cancelled"
		);

		if (alreadyRegistered) {
			alert("You are already registered for this event.");
			return;
		}

		/* TEAM EVENT â†’ redirect */
		if (e.teamParticipation) {
			alert(
				"This is a team-based event. You will be redirected to team registration."
			);
			location.href =
				"user-team-registration.html?eventId=" + eventId;
			return;
		}

		/* INDIVIDUAL EVENT */
		const confirmMsg = e.requiresApproval
			? "Your profile details will be used.\nThis event requires teacher approval.\nSubmit registration request?"
			: "Your profile details will be used.\nRegister for this event? (Auto-approved)";

		if (!confirm(confirmMsg)) return;

		const reg = {
			regId: "R" + Math.floor(Math.random() * 9000 + 1000),
			eventId,
			status: e.requiresApproval ? "pending" : "approved",
			createdAt: new Date().toISOString(),
		};

		registrations.push(reg);

		if (reg.status === "approved") {
			e.participants++;
			alert("Registered successfully (Approved).");
		} else {
			alert("Registration request submitted (Pending approval).");
		}

		render();
	}

	document
	.getElementById("searchUserTop")
	.addEventListener("keydown", (e) => {
		if (e.key === "Enter") render();
	});

	document
		.getElementById("typeFilter")
		.addEventListener("change", render);
	document
		.getElementById("approvalFilter")
		.addEventListener("change", render);

	render();

	function userLogout() {
		alert("You have been logged out.");
		location.href = "../login.html";
	}
</script>


	</body>
</html>
