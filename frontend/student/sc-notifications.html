<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Event Ease ‚Äî Notifications (Student Coordinator)</title>

  <!-- Fonts + Bootstrap -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <!-- Bootstrap Icons -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
  />
  <!-- Shared styles -->
  <link rel="stylesheet" href="../style.css" />
</head>
<body>
  <!-- TOPBAR -->
  <header class="topbar">
    <a class="d-flex align-items-center text-decoration-none" href="sc-dashboard.html">
      <div class="logo-mark">EE</div>
      <div style="margin-left: 10px; font-weight: 700; color: var(--text-dark);">
        Event Ease
      </div>
    </a>

    <div class="d-flex align-items-center gap-3">
      <input
        id="scNotifInboxSearch"
        class="form-control form-control-sm d-none d-md-block"
        style="min-width: 260px"
        placeholder="Search notifications by subject or event"
      />

      <!-- User dropdown (no bell) -->
      <div class="dropdown">
        <button class="btn d-flex align-items-center gap-2" data-bs-toggle="dropdown">
          <div
            class="rounded-circle bg-primary text-white"
            style="width: 36px; height: 36px; display: grid; place-items: center;"
          >
            SC
          </div>
          <div class="d-none d-md-block text-start">
            <div style="font-weight: 600;">Student Coord</div>
            <div class="small muted">you@college.edu</div>
          </div>
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="sc-profile.html">Profile</a></li>
          <li><hr class="dropdown-divider" /></li>
          <li><button class="dropdown-item text-danger" id="scLogoutTop">Logout</button></li>
        </ul>
      </div>
    </div>
  </header>

  <div class="app-shell">
    <!-- SIDEBAR -->
    <aside class="app-sidebar d-none d-lg-flex">
      <nav class="sidebar-nav">
        <a href="sc-dashboard.html">üè† Dashboard</a>
        <a href="sc-events.html">üìÖ My Events</a>
        <a href="sc-teams.html">üë• Manage Teams</a>
        <a href="sc-participants.html">üìã Participants</a>
        <a href="sc-notifications.html" class="active">
          üîî Notifications
          <span class="badge bg-light text-primary ms-1" id="scNotifCountBadge">3</span>
        </a>
      </nav>
    </aside>

    <!-- MAIN -->
    <main class="app-main">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <h4 class="mb-0">Notifications</h4>
          <div class="muted">
            View notifications from Admin and Teacher, and your own sent updates.
          </div>
        </div>
        <div class="d-flex gap-2">
          <a href="sc-notifications-send.html" class="btn btn-primary btn-sm">
            <span class="bi bi-send me-1"></span>Compose
          </a>
          <button type="button" id="btnBack" class="btn btn-outline btn-sm">
            ‚Üê Back
          </button>
        </div>
      </div>

      <!-- Filters -->
      <div class="card-compact mb-3">
        <div class="row g-2">
          <div class="col-6 col-md-3">
            <label class="form-label small mb-1">Source</label>
            <select id="notifSource" class="form-select">
              <option value="all">All</option>
              <option value="Admin">Admin</option>
              <option value="Teacher">Teacher</option>
              <option value="System">System</option>
              <option value="Me">My sent</option>
            </select>
          </div>
          <div class="col-6 col-md-3">
            <label class="form-label small mb-1">Status</label>
            <select id="notifStatus" class="form-select">
              <option value="all">All</option>
              <option value="unread">Unread</option>
              <option value="important">Important</option>
            </select>
          </div>
          <div class="col-12 col-md-3 d-flex align-items-end">
            <button id="btnMarkAllRead" class="btn btn-outline w-100">Mark all as read</button>
          </div>
          <div class="col-12 col-md-3 d-flex align-items-end">
            <button id="btnClearFilters" class="btn btn-outline w-100">Clear filters</button>
          </div>
        </div>
      </div>

      <!-- Notifications list -->
      <div class="card-compact">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div>
            <strong>Inbox</strong>
            <div class="muted small" id="notifSummary"></div>
          </div>
        </div>

        <div class="table-wrapper">
          <table class="table table-fixed align-middle">
            <thead>
              <tr>
                <th style="width: 90px;">From</th>
                <th class="table-col--name">Subject</th>
                <th style="width: 140px;">Event</th>
                <th style="width: 130px;">Sent at</th>
                <th style="width: 100px;">Status</th>
                <th style="width: 190px;" class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody id="notifTbody"></tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Notification detail modal -->
  <div class="modal fade" id="notifDetailModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="notifDetailTitle">Notification</h5>
          <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <span class="badge bg-secondary me-2" id="notifDetailSourceBadge">Admin</span>
            <span class="badge bg-light text-dark border" id="notifDetailEventBadge">Event</span>
          </div>
          <div class="muted small mb-2" id="notifDetailMeta"></div>
          <p id="notifDetailMessage"></p>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" type="button" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" type="button" id="btnReplyDemo">Reply</button>
        </div>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById("scLogoutTop").addEventListener("click", () => {
      if (confirm("Logout from Student Coordinator account?")) {
        alert("Logged out.");
      }
    });

    const notifBadge = document.getElementById("scNotifCountBadge");
    if (notifBadge) notifBadge.textContent = "3";

    const notifSearchInput = document.getElementById("scNotifInboxSearch");
    const sourceSelect = document.getElementById("notifSource");
    const statusSelect = document.getElementById("notifStatus");
    const btnMarkAllRead = document.getElementById("btnMarkAllRead");
    const btnClearFilters = document.getElementById("btnClearFilters");
    const notifTbody = document.getElementById("notifTbody");
    const notifSummary = document.getElementById("notifSummary");
    const btnBack = document.getElementById("btnBack");

    const notifDetailModalEl = document.getElementById("notifDetailModal");
    const notifDetailModal = new bootstrap.Modal(notifDetailModalEl);
    const notifDetailTitle = document.getElementById("notifDetailTitle");
    const notifDetailSourceBadge = document.getElementById("notifDetailSourceBadge");
    const notifDetailEventBadge = document.getElementById("notifDetailEventBadge");
    const notifDetailMeta = document.getElementById("notifDetailMeta");
    const notifDetailMessage = document.getElementById("notifDetailMessage");
    const btnReplyDemo = document.getElementById("btnReplyDemo");

    let NOTIFICATIONS = [
      {
        id: "N001",
        from: "Admin",
        subject: "Submit participant list by 30 Dec",
        event: "Hackathon 2025",
        eventId: "E101",
        sentAt: "2025-12-28T18:30:00",
        important: true,
        read: false,
        message: "Please submit the final confirmed participant list for Hackathon 2025 by 30 Dec 5 PM."
      },
      {
        id: "N002",
        from: "Teacher",
        subject: "Practice session tomorrow 10 AM",
        event: "Hackathon 2025",
        eventId: "E101",
        sentAt: "2025-12-27T17:00:00",
        important: false,
        read: false,
        message: "There will be a practice session for all Hackathon teams tomorrow at 10 AM in Lab 101."
      },
      {
        id: "N003",
        from: "System",
        subject: "New team assigned to you",
        event: "Design Sprint",
        eventId: "E102",
        sentAt: "2025-12-26T09:15:00",
        important: false,
        read: true,
        message: "Team 'Design Ninjas' has been assigned to you as Student Coordinator for Design Sprint."
      },
      {
        id: "N004",
        from: "Me",
        subject: "Reporting time for Hackathon",
        event: "Hackathon 2025",
        eventId: "E101",
        sentAt: "2025-12-25T20:00:00",
        important: false,
        read: true,
        message: "Reminder to all Hackathon participants: reporting time is 8:30 AM at Auditorium A."
      }
    ];

    let currentDetailNotif = null;

    function applyFilters() {
      const q = (notifSearchInput.value || "").toLowerCase();
      const source = sourceSelect.value;
      const status = statusSelect.value;

      let list = [...NOTIFICATIONS];

      if (source !== "all") {
        list = list.filter(n => n.from === source);
      }

      if (status === "unread") {
        list = list.filter(n => !n.read);
      } else if (status === "important") {
        list = list.filter(n => n.important);
      }

      if (q) {
        list = list.filter(
          n =>
            n.subject.toLowerCase().includes(q) ||
            n.event.toLowerCase().includes(q)
        );
      }

      renderNotifTable(list);
      updateSummary(list);
    }

    function renderNotifTable(list) {
      notifTbody.innerHTML = "";

      if (!list.length) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td colspan="6" class="text-center muted">No notifications match your filters.</td>`;
        notifTbody.appendChild(tr);
        return;
      }

      list.forEach(n => {
        const tr = document.createElement("tr");
        if (!n.read) {
          tr.style.fontWeight = "600";
        }
        tr.innerHTML = `
          <td>${n.from}</td>
          <td class="table-col--name">
            <div>${n.subject}</div>
          </td>
          <td>${n.event}</td>
          <td>${new Date(n.sentAt).toLocaleString()}</td>
          <td>
            ${
              n.important
                ? '<span class="badge bg-danger">Important</span>'
                : n.read
                ? '<span class="badge bg-secondary">Read</span>'
                : '<span class="badge bg-primary">Unread</span>'
            }
          </td>
          <td class="text-end" style="width: 190px;">
            <div class="d-flex justify-content-end gap-1">
              <button class="btn btn-outline btn-sm" onclick="openNotifDetail('${n.id}')">View</button>
              ${
                !n.read
                  ? `<button class="btn btn-outline btn-sm" onclick="markRead('${n.id}')">Mark read</button>`
                  : ""
              }
              ${
                n.from === "Admin" || n.from === "Teacher"
                  ? `<button class="btn btn-outline btn-sm" onclick="replyTo('${n.id}')">Reply</button>`
                  : ""
              }
            </div>
          </td>
        `;
        notifTbody.appendChild(tr);
      });
    }

    function updateSummary(list) {
      const total = NOTIFICATIONS.length;
      const unread = NOTIFICATIONS.filter(n => !n.read).length;
      notifSummary.textContent = `${list.length} shown ‚Ä¢ ${unread} unread of ${total} total.`;
    }

    function markAllRead() {
      NOTIFICATIONS = NOTIFICATIONS.map(n => ({ ...n, read: true }));
      applyFilters();
    }

    function markRead(id) {
      const idx = NOTIFICATIONS.findIndex(n => n.id === id);
      if (idx >= 0) {
        NOTIFICATIONS[idx].read = true;
      }
      applyFilters();
    }

    function openNotifDetail(id) {
      const n = NOTIFICATIONS.find(x => x.id === id);
      if (!n) return;

      n.read = true;
      currentDetailNotif = n;

      notifDetailTitle.textContent = n.subject;
      notifDetailSourceBadge.textContent = n.from;
      notifDetailSourceBadge.className =
        "badge " +
        (n.from === "Admin"
          ? "bg-danger"
          : n.from === "Teacher"
          ? "bg-primary"
          : n.from === "System"
          ? "bg-secondary"
          : "bg-success");

      notifDetailEventBadge.textContent = n.event || "General";
      notifDetailMeta.textContent =
        `Sent: ${new Date(n.sentAt).toLocaleString()} ‚Ä¢ Status: ` +
        (n.important ? "Important" : "Normal");
      notifDetailMessage.textContent = n.message;

      notifDetailModal.show();
      applyFilters();
    }

    // Reply button inside modal -> go to reply page
    btnReplyDemo.addEventListener("click", () => {
      if (!currentDetailNotif) return;
      replyTo(currentDetailNotif.id);
    });

    function replyTo(id) {
      const n = NOTIFICATIONS.find(x => x.id === id);
      if (!n) return;

      const toName = n.from === "Admin"
        ? "Admin"
        : n.from === "Teacher"
        ? "Teacher Coordinator"
        : n.from;
      const toRole = n.from;
      const subject = n.subject || "Notification";

      const qs = new URLSearchParams();
      qs.set("notifId", n.id);
      qs.set("toName", toName);
      qs.set("toRole", toRole);
      qs.set("subject", subject);

      window.location.href = "sc-notifications-reply.html?" + qs.toString();
    }

    notifSearchInput.addEventListener("input", applyFilters);
    sourceSelect.addEventListener("change", applyFilters);
    statusSelect.addEventListener("change", applyFilters);
    btnMarkAllRead.addEventListener("click", markAllRead);
    btnClearFilters.addEventListener("click", () => {
      notifSearchInput.value = "";
      sourceSelect.value = "all";
      statusSelect.value = "all";
      applyFilters();
    });

    if (btnBack) {
      btnBack.addEventListener("click", () => {
        if (document.referrer) {
          window.history.back();
        } else {
          window.location.href = "sc-dashboard.html";
        }
      });
    }

    applyFilters();

    window.openNotifDetail = openNotifDetail;
    window.markRead = markRead;
    window.replyTo = replyTo;
  </script>
</body>
</html>
