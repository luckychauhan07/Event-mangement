<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Event Ease â€” SC Rosters</title>

		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="../style.css" />
		<style>
			body {
				font-family: Inter, system-ui, Arial;
				background: var(--bg-light);
				color: var(--text-dark);
			}
			.app-shell {
				display: flex;
				min-height: calc(100vh - var(--header-height));
			}
			.app-sidebar {
				width: var(--sidebar-width);
				background: linear-gradient(180deg, var(--sidebar-gradient-start), var(--sidebar-gradient-end));
				color: #fff;
				padding: 28px 20px;
				display: flex;
				flex-direction: column;
				box-shadow: var(--shadow-md);
			}
			.app-main {
				flex: 1;
				padding: 32px;
			}
			@media (max-width: 991px) {
				.app-sidebar {
					display: none;
				}
				.app-main {
					padding: 24px;
				}
			}
		</style>
	</head>
	<body>
		<header class="topbar">
			<a
				class="d-flex align-items-center text-decoration-none"
				href="sc-home.html"
			>
				<div class="logo-mark">EE</div>
				<div style="margin-left: 10px; font-weight: 700; color: var(--text-dark);">Event Ease</div>
			</a>
			<div class="d-flex align-items-center gap-3">
				<input
					id="rosterSearch"
					class="form-control form-control-sm d-none d-md-block"
					placeholder="Search participants..."
				/>
				<div class="dropdown">
					<button
						class="btn d-flex align-items-center gap-2"
						data-bs-toggle="dropdown"
					>
						<div
							class="rounded-circle bg-primary text-white"
							style="
								width: 36px;
								height: 36px;
								display: grid;
								place-items: center;
							"
						>
							SC
						</div>
					</button>
				</div>
			</div>
		</header>

		<div class="app-shell">
			<aside class="app-sidebar d-none d-lg-flex">
				<nav class="sidebar-nav">
					<a href="sc-home.html"
						>ğŸ  Home</a
					>
					<a href="sc-events.html"
						>ğŸ“… Events</a
					>
					<a
						href="sc-roster.html"
						class="active"
						>ğŸ“‹ Rosters</a
					>
				</nav>
			</aside>

			<main class="app-main">
				<div class="card-compact mb-3">
					<div
						class="d-flex justify-content-between align-items-center mb-2"
					>
						<div>
							<strong>Rosters</strong>
							<div class="muted">
								Manage participants and attendance for your
								assigned events
							</div>
						</div>
						<div>
							<select
								id="selectEvent"
								class="form-select form-select-sm"
							></select>
						</div>
					</div>

					<div id="rosterTable" class="mt-2"></div>

					<div class="mt-3 text-end">
						<button
							id="rosterAddBtn"
							class="btn btn-outline btn-sm"
						>
							Request Add (teacher approval required)
						</button>
					</div>
				</div>
			</main>
		</div>

		<!-- Confirm remove -->
		<div class="modal fade" id="confirmRemoveModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Confirm</h5>
						<button
							class="btn-close"
							data-bs-dismiss="modal"
						></button>
					</div>
					<div class="modal-body" id="confirmRemoveBody"></div>
					<div class="modal-footer">
						<button class="btn btn-outline" data-bs-dismiss="modal">
							Cancel</button
						><button class="btn btn-danger" id="confirmRemoveYes">
							Remove
						</button>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			// same demo data as earlier files (keeps it self-contained)
			const SC_ID = "SC01";
			const events = [
				{
					id: "E101",
					name: "Hackathon â€” Team Coordination",
					scAssigned: SC_ID,
					participants: ["S101", "S102", "S103", "S104"],
					requiresApproval: true,
					attendance: {},
				},
				{
					id: "E102",
					name: "Design Sprint",
					scAssigned: SC_ID,
					participants: ["S106", "S107"],
					requiresApproval: false,
					attendance: {},
				},
			];
			const participantsDir = {
				S101: {
					id: "S101",
					name: "Asha Kumar",
					email: "asha@college.edu",
				},
				S102: {
					id: "S102",
					name: "Rahul Mehta",
					email: "rahul@college.edu",
				},
				S103: {
					id: "S103",
					name: "Priya Singh",
					email: "priya@college.edu",
				},
				S104: {
					id: "S104",
					name: "Dev Sharma",
					email: "dev@college.edu",
				},
				S106: {
					id: "S106",
					name: "Arjun Varma",
					email: "arjun@college.edu",
				},
				S107: {
					id: "S107",
					name: "Nisha Patel",
					email: "nisha@college.edu",
				},
			};

			const selectEvent = document.getElementById("selectEvent");
			const rosterTable = document.getElementById("rosterTable");
			let currentEventId = null;
			let pendingRemove = null;

			function init() {
				selectEvent.innerHTML = "";
				events.forEach((e) => {
					const opt = document.createElement("option");
					opt.value = e.id;
					opt.textContent = `${e.name} (${e.id})`;
					selectEvent.appendChild(opt);
				});
				if (events.length) {
					currentEventId = events[0].id;
					renderRoster();
				}
			}

			function renderRoster() {
				const ev = events.find((x) => x.id === currentEventId);
				rosterTable.innerHTML = "";
				if (!ev)
					return (rosterTable.innerHTML =
						'<div class="muted">No event selected</div>');
				const container = document.createElement("div");
				container.innerHTML = `<div class="mb-2 muted small">Event: ${
					ev.name
				} â€¢ ${ev.participants.length} participants â€¢ ${
					ev.requiresApproval
						? "Teacher approval required for adds"
						: "Adds auto-accepted"
				}</div>`;
				ev.participants.forEach((pid) => {
					const p = participantsDir[pid] || { id: pid, name: pid };
					const row = document.createElement("div");
					row.className =
						"d-flex justify-content-between align-items-center mb-2";
					row.innerHTML = `<div><div style="font-weight:600">${p.name}</div><div class="muted small">${p.id}</div></div>
          <div>
            <button class="btn btn-sm btn-outline me-1" onclick="alert('View participant (demo)')">View</button>
            <button class="btn btn-sm btn-outline me-1" onclick="triggerMark('${ev.id}','${pid}')">Toggle Present</button>
            <button class="btn btn-sm btn-danger" onclick="promptRemove('${ev.id}','${pid}')">Remove</button>
          </div>`;
					container.appendChild(row);
				});
				rosterTable.appendChild(container);
			}

			function triggerMark(eventId, pid) {
				const ev = events.find((e) => e.id === eventId);
				ev.attendance = ev.attendance || {};
				ev.attendance[pid] = !ev.attendance[pid];
				alert(
					`${pid} marked as ${
						ev.attendance[pid] ? "Present" : "Absent"
					} (local demo)`
				);
				renderRoster();
			}

			function promptRemove(eventId, pid) {
				pendingRemove = { eventId, pid };
				document.getElementById(
					"confirmRemoveBody"
				).textContent = `Remove ${pid} from ${eventId}? This will notify teacher.`;
				document.getElementById("confirmRemoveYes").onclick =
					confirmRemove;
				new bootstrap.Modal(
					document.getElementById("confirmRemoveModal")
				).show();
			}

			function confirmRemove() {
				if (!pendingRemove) return;
				const { eventId, pid } = pendingRemove;
				const ev = events.find((e) => e.id === eventId);
				ev.participants = ev.participants.filter((x) => x !== pid);
				if (ev.attendance && ev.attendance[pid])
					delete ev.attendance[pid];
				alert("Teacher notified (demo) â€” participant removed");
				pendingRemove = null;
				new bootstrap.Modal(
					document.getElementById("confirmRemoveModal")
				).hide();
				renderRoster();
			}

			selectEvent.addEventListener("change", (e) => {
				currentEventId = e.target.value;
				renderRoster();
			});
			document
				.getElementById("rosterAddBtn")
				.addEventListener("click", () => {
					alert(
						"Open add request UI (demo) â€” request will be sent to teacher"
					);
				});

			init();
		</script>
	</body>
</html>
