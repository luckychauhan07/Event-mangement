<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Event Ease ‚Äî Student Coordinator Home</title>

		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="../style.css" />

		<style>
			:root {
				--header-h: 64px;
			}
			body {
				font-family: Inter, system-ui, Arial;
				background: var(--bg-light);
				color: var(--text-dark);
			}
			.topbar {
				height: var(--header-h);
				display: flex;
				align-items: center;
				justify-content: space-between;
				padding: 0 20px;
				background: #fff;
				border-bottom: 1px solid var(--border);
				position: sticky;
				top: 0;
				z-index: 20;
			}
			.app-shell {
				display: flex;
				min-height: calc(100vh - var(--header-h));
			}
			.app-sidebar {
				width: 240px;
				background: linear-gradient(180deg, #0f172a, #0b1a3a);
				color: #fff;
				padding: 18px;
				display: flex;
				flex-direction: column;
			}
			.app-main {
				flex: 1;
				padding: 22px;
			}
			.card-compact {
				background: var(--bg-surface);
				border-radius: 10px;
				padding: 16px;
				border: 1px solid var(--border);
			}
			.muted {
				color: var(--text-muted);
			}
			.small-gap {
				gap: 8px;
				display: flex;
				align-items: center;
			}
			@media (max-width: 900px) {
				.app-sidebar {
					display: none;
				}
			}
		</style>
	</head>
	<body>
		<!-- Header -->
		<header class="topbar">
			<a
				class="d-flex align-items-center text-decoration-none"
				href="sc-home.html"
			>
				<div
					style="
						width: 36px;
						height: 36px;
						border-radius: 8px;
						background: linear-gradient(180deg, #3b82f6, #2b6ee6);
						display: grid;
						place-items: center;
						color: #fff;
						font-weight: 700;
					"
				>
					EE
				</div>
				<div
					style="
						margin-left: 8px;
						font-weight: 700;
						color: var(--text-dark);
					"
				>
					Event Ease
				</div>
			</a>

			<div class="d-flex align-items-center gap-3">
				<input
					id="scSearch"
					class="form-control form-control-sm d-none d-md-block"
					style="min-width: 260px"
					placeholder="Search your events, participants"
				/>
				<div class="dropdown">
					<button
						class="btn d-flex align-items-center gap-2"
						data-bs-toggle="dropdown"
					>
						<div
							class="rounded-circle bg-primary text-white d-inline-grid"
							style="
								width: 36px;
								height: 36px;
								place-items: center;
							"
						>
							SC
						</div>
						<div class="d-none d-md-block text-start">
							<div style="font-weight: 600">Student Coord</div>
							<div class="muted">sc@college.edu</div>
						</div>
					</button>
					<ul class="dropdown-menu dropdown-menu-end">
						<li>
							<a class="dropdown-item" href="sc-events.html"
								>My Events</a
							>
						</li>
						<li>
							<a class="dropdown-item" href="sc-roster.html"
								>My Rosters</a
							>
						</li>
						<li><hr class="dropdown-divider" /></li>
						<li>
							<button
								class="dropdown-item text-danger"
								id="scLogout"
							>
								Logout
							</button>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div class="app-shell">
			<!-- Sidebar -->
			<aside class="app-sidebar d-none d-lg-flex" aria-label="Sidebar">
				<nav style="display: flex; flex-direction: column; gap: 10px">
					<a
						class="text-white-95 p-2 rounded active"
						href="sc-home.html"
						>üè† Home</a
					>
					<a class="text-white-95 p-2 rounded" href="sc-events.html"
						>üìÖ My Events</a
					>
					<a class="text-white-95 p-2 rounded" href="sc-roster.html"
						>üìã Rosters</a
					>
					<a
						class="text-white-95 p-2 rounded"
						href="teacher-approvals-clean.html"
						>üîÅ Teacher Approvals</a
					>
				</nav>
				<div style="margin-top: auto">
					<div class="small text-white-75">
						v1.0 ‚Ä¢ ¬© <span id="scYear"></span>
					</div>
				</div>
			</aside>

			<!-- Main -->
			<main class="app-main">
				<div
					class="d-flex justify-content-between align-items-center mb-3"
				>
					<div>
						<h4 class="mb-0">Welcome ‚Äî Student Coordinator</h4>
						<div class="muted">
							You can manage participants and attendance for
							events assigned to you. Note: teacher is final
							approver for registrations that require approval.
						</div>
					</div>
					<div class="small-gap">
						<button
							class="btn btn-outline btn-sm"
							id="btnNotifyAll"
						>
							Notify Participants
						</button>
						<button
							class="btn btn-primary btn-sm"
							id="btnExportRoster"
						>
							Export Roster
						</button>
					</div>
				</div>

				<!-- Top: Assigned (most important) event -->
				<div class="card-compact mb-3">
					<div class="d-flex justify-content-between">
						<div>
							<div class="muted">Your primary assigned event</div>
							<h3 id="scPrimaryTitle">
								Hackathon ‚Äî Team Coordination
							</h3>
							<div class="muted" id="scPrimaryMeta">
								Dec 05, 2025 ¬∑ Auditorium A
							</div>
							<p class="muted mt-2" id="scPrimaryDesc">
								Coordinate teams, maintain roster, mark
								attendance during the event. Teacher approval
								required for team registrations.
							</p>

							<div class="d-flex gap-2 mt-2">
								<button
									class="btn btn-primary"
									id="btnViewRosterTop"
								>
									View Roster
								</button>
								<button
									class="btn btn-outline"
									id="btnMarkAttendanceTop"
								>
									Mark Attendance
								</button>
								<button
									class="btn btn-outline"
									id="btnRequestAdd"
									title="Student add requests will be sent to teacher for final approval"
								>
									Request Add Participant
								</button>
							</div>
						</div>

						<div style="text-align: right; min-width: 140px">
							<div class="muted">Participants</div>
							<div style="font-weight: 700" id="scPrimaryCount">
								45
							</div>
							<div class="muted mt-3">Status</div>
							<div class="mt-1">
								<span
									id="scPrimaryStatus"
									class="badge bg-success"
									>Ongoing</span
								>
							</div>
						</div>
					</div>
				</div>

				<!-- Events list (compact) -->
				<div class="card-compact mb-3">
					<div
						class="d-flex justify-content-between align-items-center mb-2"
					>
						<div>
							<strong>Assigned Events</strong>
							<div class="muted">
								Only events where you are the student
								coordinator
							</div>
						</div>
						<div>
							<a
								class="btn btn-outline btn-sm"
								href="sc-events.html"
								>Manage</a
							>
						</div>
					</div>

					<div class="table-responsive">
						<table class="table align-middle">
							<thead>
								<tr>
									<th>Event</th>
									<th>Date</th>
									<th>Venue</th>
									<th>Participants</th>
									<th></th>
								</tr>
							</thead>
							<tbody id="scEventsList"></tbody>
						</table>
					</div>
				</div>

				<div class="muted">
					If you add participants, they may need teacher approval
					depending on event settings. Removal of participants sends a
					notification to teacher.
				</div>
			</main>
		</div>

		<!-- Modals -->
		<div class="modal fade" id="modalRoster" tabindex="-1">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Roster</h5>
						<button
							class="btn-close"
							data-bs-dismiss="modal"
						></button>
					</div>
					<div class="modal-body" id="modalRosterBody"></div>
					<div class="modal-footer">
						<button class="btn btn-outline" data-bs-dismiss="modal">
							Close</button
						><button class="btn btn-primary" id="modalExport">
							Export
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="modalAttendance" tabindex="-1">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Mark Attendance</h5>
						<button
							class="btn-close"
							data-bs-dismiss="modal"
						></button>
					</div>
					<div class="modal-body" id="modalAttendanceBody"></div>
					<div class="modal-footer">
						<button class="btn btn-outline" data-bs-dismiss="modal">
							Cancel</button
						><button class="btn btn-primary" id="saveAttendance">
							Save Attendance
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="modalAddRequest" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Request Add Participant</h5>
						<button
							class="btn-close"
							data-bs-dismiss="modal"
						></button>
					</div>
					<div class="modal-body">
						<div class="mb-2">
							<label class="form-label">Student ID</label
							><input
								id="reqStudentId"
								class="form-control"
								placeholder="S123"
							/>
						</div>
						<div class="mb-2">
							<label class="form-label">Student name</label
							><input id="reqStudentName" class="form-control" />
						</div>
						<div class="muted small">
							This will send a request to the teacher for approval
							when the event requires approval.
						</div>
					</div>
					<div class="modal-footer">
						<button class="btn btn-outline" data-bs-dismiss="modal">
							Cancel</button
						><button class="btn btn-primary" id="sendAddRequest">
							Send Request
						</button>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

		<script>
			// Demo: current student coordinator id
			const SC_ID = "SC01";

			// Demo events: only events where SC is coordinator will be shown
			const allEvents = [
				{
					id: "E101",
					name: "Hackathon ‚Äî Team Coordination",
					date: "2025-12-05T10:00",
					venue: "Auditorium A",
					manager: "TCH01",
					requiresApproval: true,
					teamParticipation: true,
					scAssigned: SC_ID,
					participants: ["S101", "S102", "S103", "S104"],
					attendance: {},
					status: "Ongoing",
				},
				{
					id: "E102",
					name: "Design Sprint",
					date: "2025-12-12T09:00",
					venue: "Lab 101",
					manager: "TCH01",
					requiresApproval: false,
					teamParticipation: true,
					scAssigned: SC_ID,
					participants: ["S106", "S107"],
					attendance: {},
					status: "Upcoming",
				},
				{
					id: "E200",
					name: "Food Fest (not managed by this SC)",
					date: "2025-12-15T16:00",
					venue: "Hall B",
					manager: "TCH02",
					requiresApproval: false,
					teamParticipation: false,
					scAssigned: null,
					participants: ["S201"],
					attendance: {},
					status: "Upcoming",
				},
			];

			// participant directory
			const participantsDir = {
				S101: {
					id: "S101",
					name: "Asha Kumar",
					email: "asha@college.edu",
				},
				S102: {
					id: "S102",
					name: "Rahul Mehta",
					email: "rahul@college.edu",
				},
				S103: {
					id: "S103",
					name: "Priya Singh",
					email: "priya@college.edu",
				},
				S104: {
					id: "S104",
					name: "Dev Sharma",
					email: "dev@college.edu",
				},
				S106: {
					id: "S106",
					name: "Arjun Varma",
					email: "arjun@college.edu",
				},
				S107: {
					id: "S107",
					name: "Nisha Patel",
					email: "nisha@college.edu",
				},
				S201: {
					id: "S201",
					name: "Visitor One",
					email: "visitor@guest",
				},
			};

			// Local store for add requests (SC sends, teacher approves)
			let addRequests = [];

			// UI refs
			const scEventsList = document.getElementById("scEventsList");
			const scYear = document.getElementById("scYear");
			const scPrimaryTitle = document.getElementById("scPrimaryTitle");
			const scPrimaryCount = document.getElementById("scPrimaryCount");
			const scPrimaryStatus = document.getElementById("scPrimaryStatus");
			const modalRosterBody = document.getElementById("modalRosterBody");
			const modalAttendanceBody = document.getElementById(
				"modalAttendanceBody"
			);

			scYear.textContent = new Date().getFullYear();

			// Helper
			function assignedEvents() {
				return allEvents.filter((e) => e.scAssigned === SC_ID);
			}

			function renderAssignedEvents() {
				const list = assignedEvents();
				scEventsList.innerHTML = "";
				if (list.length === 0) {
					scEventsList.innerHTML =
						'<div class="muted">You have no assigned events.</div>';
					return;
				}
				list.forEach((ev) => {
					const tr = document.createElement("tr");
					tr.innerHTML = `<td style="font-weight:600">${
						ev.name
					}<div class="small muted">${ev.id}</div></td>
          <td>${new Date(ev.date).toLocaleDateString()}</td>
          <td>${ev.venue}</td>
          <td>${ev.participants.length}</td>
          <td class="text-end">
            <button class="btn btn-sm btn-outline me-1" onclick="openRoster('${
				ev.id
			}')">Roster</button>
            <button class="btn btn-sm btn-outline me-1" onclick="openAttendance('${
				ev.id
			}')">Attendance</button>
            <button class="btn btn-sm btn-primary" onclick="exportRoster('${
				ev.id
			}')">Export</button>
          </td>`;
					scEventsList.appendChild(tr);
				});

				// top primary
				const primary = list[0];
				if (primary) {
					scPrimaryTitle.textContent = primary.name;
					scPrimaryCount.textContent = primary.participants.length;
					scPrimaryStatus.textContent =
						primary.status === "Ongoing"
							? "Ongoing"
							: primary.status;
				}
			}

			// Roster modal
			function openRoster(eventId) {
				const ev = allEvents.find((e) => e.id === eventId);
				if (!ev) return alert("Event not found");
				modalRosterBody.innerHTML = "";
				if (ev.participants.length === 0)
					modalRosterBody.innerHTML =
						'<div class="muted">No participants</div>';
				ev.participants.forEach((pid) => {
					const p = participantsDir[pid] || { id: pid, name: pid };
					const row = document.createElement("div");
					row.className =
						"d-flex justify-content-between align-items-center mb-2";
					row.innerHTML = `<div><div style="font-weight:600">${
						p.name
					}</div><div class="muted small">${p.id} ‚Ä¢ ${
						p.email || ""
					}</div></div>
          <div>
            <button class="btn btn-sm btn-outline me-1" onclick="viewParticipant('${eventId}','${pid}')">View</button>
            <button class="btn btn-sm btn-danger" onclick="removeParticipant('${eventId}','${pid}')">Remove</button>
          </div>`;
					modalRosterBody.appendChild(row);
				});

				// show pending add requests (SC-created)
				const myRequests = addRequests.filter(
					(r) => r.eventId === eventId
				);
				if (myRequests.length) {
					const hr = document.createElement("hr");
					modalRosterBody.appendChild(hr);
					modalRosterBody.appendChild(
						document.createElement("div")
					).innerHTML =
						'<div class="muted small">Pending add requests (awaiting teacher approval)</div>';
					myRequests.forEach((r) => {
						const el = document.createElement("div");
						el.className =
							"d-flex justify-content-between align-items-center mb-2";
						el.innerHTML = `<div><div style="font-weight:600">${r.name}</div><div class="muted small">${r.id}</div></div><div class="muted small">Requested by you</div>`;
						modalRosterBody.appendChild(el);
					});
				}

				new bootstrap.Modal(
					document.getElementById("modalRoster")
				).show();
			}

			function viewParticipant(eventId, pid) {
				const p = participantsDir[pid] || { id: pid, name: pid };
				alert(
					`Participant\nName: ${p.name}\nID: ${p.id}\nEmail: ${
						p.email || "‚Äî"
					}`
				);
			}

			// Remove participant ‚Äî SC can remove, but action notifies teacher (demo)
			function removeParticipant(eventId, pid) {
				if (
					!confirm(
						"Remove participant " +
							pid +
							" from event? This will notify teacher."
					)
				)
					return;
				const ev = allEvents.find((e) => e.id === eventId);
				ev.participants = ev.participants.filter((x) => x !== pid);
				// also remove any local attendance
				if (ev.attendance && ev.attendance[pid])
					delete ev.attendance[pid];
				// notify teacher (demo)
				alert("Teacher notified (demo). Participant removed.");
				renderAssignedEvents();
				new bootstrap.Modal(
					document.getElementById("modalRoster")
				).hide();
			}

			// Attendance modal
			function openAttendance(eventId) {
				const ev = allEvents.find((e) => e.id === eventId);
				modalAttendanceBody.innerHTML = "";
				if (ev.participants.length === 0) {
					modalAttendanceBody.innerHTML =
						'<div class="muted">No participants</div>';
					new bootstrap.Modal(
						document.getElementById("modalAttendance")
					).show();
					return;
				}
				ev.participants.forEach((pid) => {
					const p = participantsDir[pid] || { id: pid, name: pid };
					const div = document.createElement("div");
					const checked =
						ev.attendance && ev.attendance[pid] ? "checked" : "";
					div.className =
						"form-check d-flex justify-content-between align-items-center mb-2";
					div.innerHTML = `<div><input class="form-check-input me-2" type="checkbox" id="att-${pid}" ${checked}><label class="form-check-label" for="att-${pid}">${p.name} <span class="muted small">(${pid})</span></label></div>`;
					modalAttendanceBody.appendChild(div);
				});
				// attach save handler
				document.getElementById("saveAttendance").onclick = () => {
					ev.attendance = ev.attendance || {};
					ev.participants.forEach((pid) => {
						const chk = document.getElementById("att-" + pid);
						ev.attendance[pid] = !!chk && chk.checked;
					});
					alert("Attendance saved (local demo)");
					new bootstrap.Modal(
						document.getElementById("modalAttendance")
					).hide();
				};
				new bootstrap.Modal(
					document.getElementById("modalAttendance")
				).show();
			}

			// Export roster (client-side CSV)
			function exportRoster(eventId) {
				const ev = allEvents.find((e) => e.id === eventId);
				const rows = ev.participants.map((pid) => {
					const p = participantsDir[pid] || { id: pid, name: pid };
					const att =
						ev.attendance && ev.attendance[pid]
							? "Present"
							: "Absent";
					return {
						id: p.id,
						name: p.name,
						email: p.email || "",
						attendance: att,
					};
				});
				if (rows.length === 0)
					return alert("No participants to export");
				const cols = ["id", "name", "email", "attendance"];
				const csv = [cols.join(",")]
					.concat(
						rows.map((r) =>
							cols
								.map(
									(c) =>
										`"${(r[c] || "")
											.toString()
											.replace(/"/g, '""')}"`
								)
								.join(",")
						)
					)
					.join("\n");
				const blob = new Blob([csv], { type: "text/csv" });
				const url = URL.createObjectURL(blob);
				const a = document.createElement("a");
				a.href = url;
				a.download = `${ev.id}-roster.csv`;
				document.body.appendChild(a);
				a.click();
				a.remove();
				URL.revokeObjectURL(url);
			}

			// Add participant request (SC submits, teacher must approve if requiresApproval)
			document
				.getElementById("btnRequestAdd")
				.addEventListener("click", () => {
					new bootstrap.Modal(
						document.getElementById("modalAddRequest")
					).show();
				});
			document
				.getElementById("sendAddRequest")
				.addEventListener("click", () => {
					const id = (
						document.getElementById("reqStudentId").value || ""
					).trim();
					const name = (
						document.getElementById("reqStudentName").value || ""
					).trim();
					const primary = assignedEvents()[0];
					if (!id || !name) return alert("Provide student id & name");
					if (!primary) return alert("No assigned event");
					addRequests.push({
						id,
						name,
						eventId: primary.id,
						requestedBy: SC_ID,
						when: new Date().toISOString(),
					});
					alert("Request sent to teacher (demo)");
					new bootstrap.Modal(
						document.getElementById("modalAddRequest")
					).hide();
				});

			// Top buttons
			document
				.getElementById("btnViewRosterTop")
				.addEventListener("click", () => {
					const primary = assignedEvents()[0];
					if (!primary) return alert("No primary event");
					openRoster(primary.id);
				});
			document
				.getElementById("btnMarkAttendanceTop")
				.addEventListener("click", () => {
					const primary = assignedEvents()[0];
					if (!primary) return alert("No primary event");
					openAttendance(primary.id);
				});
			document
				.getElementById("btnExportRoster")
				.addEventListener("click", () => {
					const primary = assignedEvents()[0];
					if (!primary) return alert("No primary event");
					exportRoster(primary.id);
				});
			document
				.getElementById("btnNotifyAll")
				.addEventListener("click", () =>
					alert("Open notification composer (demo)")
				);

			// Save handlers used above
			window.openRoster = openRoster;
			window.openAttendance = openAttendance;
			window.exportRoster = exportRoster;
			window.removeParticipant = removeParticipant;

			renderAssignedEvents();
		</script>
	</body>
</html>
