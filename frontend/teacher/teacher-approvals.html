<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Event Ease ‚Äî Approvals (Teacher)</title>

		<!-- Inter + Bootstrap -->
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>

		<!-- Your shared design tokens -->
		<link rel="stylesheet" href="../style.css" />

		<style>
			:root {
				--header-h: 64px;
			}
			body {
				font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto,
					Arial;
				background: var(--bg-light);
				color: var(--text-dark);
			}
			.topbar {
				height: var(--header-h);
				display: flex;
				align-items: center;
				justify-content: space-between;
				padding: 0 20px;
				background: #fff;
				border-bottom: 1px solid var(--border);
				position: sticky;
				top: 0;
				z-index: 20;
			}
			.app-shell {
				display: flex;
				min-height: calc(100vh - var(--header-h));
			}
			.app-sidebar {
				width: 240px;
				background: linear-gradient(180deg, #1e3a8a, #12224a);
				color: #fff;
				padding: 18px;
				display: flex;
				flex-direction: column;
			}
			.app-main {
				flex: 1;
				padding: 22px;
			}
			.card-pane {
				background: var(--bg-surface);
				border: 1px solid var(--border);
				border-radius: 10px;
				padding: 16px;
			}
			.muted {
				color: var(--text-muted);
				font-size: 13px;
			}
			.approvals-scroll {
				max-height: 420px;
				overflow: auto;
			}
			.participants-scroll {
				max-height: 320px;
				overflow: auto;
			}
			.small-gap {
				gap: 10px;
				display: flex;
				align-items: center;
			}
			@media (max-width: 992px) {
				.app-sidebar {
					display: none;
				}
				.approvals-scroll,
				.participants-scroll {
					max-height: 260px;
				}
			}
			.tag {
				font-size: 12px;
				padding: 4px 8px;
				border-radius: 999px;
				display: inline-block;
			}
		</style>
	</head>
	<body>
		<!-- HEADER -->
		<header class="topbar">
			<a
				href="teacher-home.html"
				class="d-flex align-items-center text-decoration-none"
			>
				<div
					style="
						width: 36px;
						height: 36px;
						border-radius: 8px;
						background: linear-gradient(180deg, #3b82f6, #2b6ee6);
						display: grid;
						place-items: center;
						color: #fff;
						font-weight: 700;
					"
				>
					EE
				</div>
				<div style="margin-left: 10px; font-weight: 700">
					Event Ease
				</div>
			</a>

			<div class="d-flex align-items-center gap-3">
				<input
					id="globalSearch"
					class="form-control form-control-sm d-none d-md-block"
					style="min-width: 260px"
					placeholder="Search approvals / events"
				/>
				<div class="dropdown">
					<button
						class="btn d-flex align-items-center gap-2"
						data-bs-toggle="dropdown"
						aria-expanded="false"
						aria-label="Teacher menu"
					>
						<div
							class="rounded-circle bg-primary text-white d-inline-grid"
							style="
								width: 36px;
								height: 36px;
								place-items: center;
							"
						>
							TC
						</div>
						<div class="d-none d-md-block text-start">
							<div style="font-weight: 600">Teacher</div>
							<div class="muted">teacher@college.edu</div>
						</div>
					</button>
					<ul class="dropdown-menu dropdown-menu-end">
						<li>
							<a class="dropdown-item" href="teacher-profile.html"
								>Profile</a
							>
						</li>
						<li>
							<a class="dropdown-item" href="teacher-home.html"
								>Home</a
							>
						</li>
						<li><hr class="dropdown-divider" /></li>
						<li>
							<button
								class="dropdown-item text-danger"
								id="logoutTop"
							>
								Logout
							</button>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div class="app-shell">
			<!-- SIDEBAR -->
			<aside
				class="app-sidebar d-none d-lg-flex"
				aria-label="Main navigation"
			>
				<nav style="display: flex; flex-direction: column; gap: 10px">
					<a
						href="teacher-home.html"
						class="text-white-95 p-2 rounded"
						>üè† Home</a
					>
					<a
						href="teacher-events.html"
						class="text-white-95 p-2 rounded"
						>üìÖ My Events</a
					>
					<a
						href="teacher-approvals-clean.html"
						class="text-white-95 p-2 rounded active"
						>‚úÖ Approvals</a
					>
					<a
						href="teacher-profile.html"
						class="text-white-95 p-2 rounded"
						>üë§ Profile</a
					>
				</nav>

				<div style="margin-top: auto">
					<a id="logoutSide" class="text-danger p-2 d-inline-block"
						>üîí Logout</a
					>
					<div class="small text-white-75 mt-2">
						¬© <span id="year"></span> Event Ease
					</div>
				</div>
			</aside>

			<!-- MAIN -->
			<main class="app-main">
				<div
					class="d-flex justify-content-between align-items-center mb-3"
				>
					<div>
						<h4 class="mb-0">Approvals</h4>
						<div class="muted">
							Only team approvals for events you manage that
							require approval
						</div>
					</div>

					<div class="small-gap">
						<input
							id="filterEvent"
							class="form-control form-control-sm"
							placeholder="Filter by event name"
							style="min-width: 220px"
						/>
						<button id="btnRefresh" class="btn btn-outline btn-sm">
							Refresh
						</button>
					</div>
				</div>

				<div class="row g-3">
					<!-- Left column: pending approvals list -->
					<div class="col-12 col-lg-7">
						<div class="card-pane">
							<div
								class="d-flex justify-content-between align-items-center mb-2"
							>
								<div><strong>Pending approvals</strong></div>
								<div>
									<span
										id="pendingCount"
										class="tag bg-warning"
										>0</span
									>
								</div>
							</div>

							<div
								id="approvals"
								class="approvals-scroll"
								aria-live="polite"
							>
								<!-- rendered by JS -->
							</div>
						</div>

						<div class="card-pane mt-3">
							<h6 class="mb-2">Activity</h6>
							<div id="activity" class="muted small">
								No actions yet
							</div>
						</div>
					</div>

					<!-- Right column: managed events & participants -->
					<div class="col-12 col-lg-5">
						<div class="card-pane mb-3">
							<div
								class="d-flex justify-content-between align-items-center mb-2"
							>
								<div>
									<strong>Your events (team-based)</strong>
								</div>
								<div>
									<a class="small" href="teacher-events.html"
										>Manage</a
									>
								</div>
							</div>
							<div id="managedEvents" class="participants-scroll">
								<!-- events list -->
							</div>
						</div>

						<div class="card-pane">
							<div
								class="d-flex justify-content-between align-items-center mb-2"
							>
								<div>
									<strong id="selectedTitle"
										>Select an event</strong
									>
									<div
										class="muted small"
										id="selectedMeta"
									></div>
								</div>
							</div>

							<div
								id="participants"
								class="participants-scroll muted small"
							>
								No event selected
							</div>

							<div class="mt-3 text-end">
								<button
									id="assignCoordBtn"
									class="btn btn-outline btn-sm"
									disabled
								>
									Assign Student Coordinator
								</button>
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>

		<!-- Modals -->
		<!-- Approve modal -->
		<div
			class="modal fade"
			id="modalApprove"
			tabindex="-1"
			aria-hidden="true"
		>
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="modalApproveTitle">
							Approval
						</h5>
						<button
							class="btn-close"
							data-bs-dismiss="modal"
						></button>
					</div>
					<div class="modal-body" id="modalApproveBody"></div>
					<div class="modal-footer">
						<button class="btn btn-outline" data-bs-dismiss="modal">
							Close
						</button>
						<button id="modalReject" class="btn btn-danger">
							Reject
						</button>
						<button id="modalApproveBtn" class="btn btn-primary">
							Approve
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Assign coordinator modal -->
		<div
			class="modal fade"
			id="modalAssign"
			tabindex="-1"
			aria-hidden="true"
		>
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Assign Student Coordinator</h5>
						<button
							class="btn-close"
							data-bs-dismiss="modal"
						></button>
					</div>
					<div class="modal-body">
						<div class="muted small mb-2" id="assignInfo"></div>
						<label class="form-label">Choose student</label>
						<select id="assignSelect" class="form-select"></select>
					</div>
					<div class="modal-footer">
						<button class="btn btn-outline" data-bs-dismiss="modal">
							Cancel
						</button>
						<button id="assignConfirm" class="btn btn-primary">
							Assign
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Remove participant confirm -->
		<div
			class="modal fade"
			id="modalRemove"
			tabindex="-1"
			aria-hidden="true"
		>
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Remove participant</h5>
						<button
							class="btn-close"
							data-bs-dismiss="modal"
						></button>
					</div>
					<div class="modal-body" id="modalRemoveBody">
						Confirm remove?
					</div>
					<div class="modal-footer">
						<button class="btn btn-outline" data-bs-dismiss="modal">
							Cancel
						</button>
						<button id="removeConfirm" class="btn btn-danger">
							Remove
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- Bootstrap JS -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

		<script>
			/***********************
			 * Demo in-memory data *
			 ***********************/
			const TEACHER_ID = "TCH01"; // currently logged in teacher (demo)

			// events: only events with manager===TEACHER_ID and teamParticipation===true and requiresApproval===true appear in approvals
			const events = [
				{
					id: "E101",
					name: "Inter-College Hackathon",
					manager: TEACHER_ID,
					teamParticipation: true,
					requiresApproval: true,
					type: "Tech",
					participants: ["S101", "S102", "S103"],
					studentCoordinators: [],
				},
				{
					id: "E102",
					name: "Food Fest",
					manager: TEACHER_ID,
					teamParticipation: false,
					requiresApproval: false,
					type: "Cultural",
					participants: ["S104", "S105"],
					studentCoordinators: [],
				},
				{
					id: "E103",
					name: "Robotics Challenge",
					manager: "OTHER",
					teamParticipation: true,
					requiresApproval: true,
					type: "Tech",
					participants: ["S201", "S202"],
					studentCoordinators: [],
				},
				{
					id: "E104",
					name: "Design Sprint",
					manager: TEACHER_ID,
					teamParticipation: true,
					requiresApproval: false,
					type: "Workshop",
					participants: ["S106"],
					studentCoordinators: ["S106"],
				},
			];

			// pending approvals (some belong to events the teacher manages, some not)
			let pending = [
				{
					id: "A1",
					eventId: "E101",
					type: "team",
					summary: "Team Alpha requests approval",
					details: "Members: S101, S102, S103",
					submittedBy: "S101",
					when: "2h ago",
				},
				{
					id: "A2",
					eventId: "E101",
					type: "participant",
					summary: "S107 requests individual participation",
					details: "S107 ‚Ä¢ CS201",
					submittedBy: "S107",
					when: "4h ago",
				},
				{
					id: "A3",
					eventId: "E103",
					type: "team",
					summary: "Team Delta requests approval",
					details: "Members: S201, S202",
					submittedBy: "S201",
					when: "1d ago",
				},
				{
					id: "A4",
					eventId: "E104",
					type: "team",
					summary: "Team Z for Design Sprint",
					details: "Members: S106, S108",
					submittedBy: "S106",
					when: "3h ago",
				},
			];

			// participant directory
			const participants = {
				S101: {
					id: "S101",
					name: "Asha Kumar",
					email: "asha@college.edu",
				},
				S102: {
					id: "S102",
					name: "Rahul Mehta",
					email: "rahul@college.edu",
				},
				S103: {
					id: "S103",
					name: "Priya Singh",
					email: "priya@college.edu",
				},
				S104: {
					id: "S104",
					name: "Dev Sharma",
					email: "dev@college.edu",
				},
				S105: {
					id: "S105",
					name: "Maya Rao",
					email: "maya@college.edu",
				},
				S106: {
					id: "S106",
					name: "Arjun Varma",
					email: "arjun@college.edu",
				},
				S107: {
					id: "S107",
					name: "Nisha Patel",
					email: "nisha@college.edu",
				},
				S108: {
					id: "S108",
					name: "Rita Das",
					email: "rita@college.edu",
				},
				S201: {
					id: "S201",
					name: "Karan Gill",
					email: "karan@college.edu",
				},
				S202: {
					id: "S202",
					name: "Meera Iyer",
					email: "meera@college.edu",
				},
			};

			// UI state
			let selectedEvent = null; // event id
			let selectedParticipantToRemove = null;
			const approvalsEl = document.getElementById("approvals");
			const managedEventsEl = document.getElementById("managedEvents");
			const participantsEl = document.getElementById("participants");
			const selectedTitle = document.getElementById("selectedTitle");
			const selectedMeta = document.getElementById("selectedMeta");
			const pendingCountEl = document.getElementById("pendingCount");
			document.getElementById("year").textContent =
				new Date().getFullYear();

			/**********************
			 * Utility functions  *
			 **********************/
			function isManagedByTeacher(ev) {
				return ev.manager === TEACHER_ID;
			}
			function approvalsFilter(ev) {
				return (
					isManagedByTeacher(ev) &&
					ev.teamParticipation &&
					ev.requiresApproval
				);
			}
			function logAction(text) {
				const a = document.getElementById("activity");
				const el = document.createElement("div");
				el.innerHTML = `<div style="font-weight:600">${text}</div><div class="muted small">${new Date().toLocaleString()}</div>`;
				a.prepend(el);
			}

			/****************************
			 * Render: Approvals section *
			 ****************************/
			function renderApprovals() {
				// only approvals for events that match approvalsFilter
				const q = (
					document.getElementById("filterEvent").value || ""
				).toLowerCase();
				const filtered = pending.filter((p) => {
					const ev = events.find((e) => e.id === p.eventId);
					if (!ev) return false;
					if (!approvalsFilter(ev)) return false;
					if (
						q &&
						!(ev.name + " " + p.summary + " " + p.submittedBy)
							.toLowerCase()
							.includes(q)
					)
						return false;
					return true;
				});

				pendingCountEl.textContent = `${filtered.length} pending`;
				approvalsEl.innerHTML = "";

				if (filtered.length === 0) {
					approvalsEl.innerHTML =
						'<div class="muted">No pending approvals for your team-based events that require approval.</div>';
					return;
				}

				filtered.forEach((a) => {
					const ev = events.find((e) => e.id === a.eventId);
					const card = document.createElement("div");
					card.className = "mb-3";
					card.innerHTML = `
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <div style="font-weight:700">${a.summary}</div>
              <div class="muted small">${ev.name} ‚Ä¢ ${a.type} ‚Ä¢ ${a.when} ‚Ä¢ submitted by ${a.submittedBy}</div>
              <div class="muted small mt-2">${a.details}</div>
            </div>
            <div class="text-end">
              <button class="btn btn-sm btn-outline me-1" onclick="openApproveModal('${a.id}')">View</button>
              <button class="btn btn-sm btn-primary me-1" onclick="handleApprove('${a.id}')">Approve</button>
              <button class="btn btn-sm btn-danger" onclick="handleReject('${a.id}')">Reject</button>
            </div>
          </div>
        `;
					approvalsEl.appendChild(card);
				});
			}

			/**************************************
			 * Render: Events you manage (right)  *
			 **************************************/
			function renderManagedEvents() {
				managedEventsEl.innerHTML = "";
				const managed = events.filter(
					(e) => isManagedByTeacher(e) && e.teamParticipation
				);
				if (managed.length === 0) {
					managedEventsEl.innerHTML =
						'<div class="muted">You have no team-based events.</div>';
					return;
				}
				managed.forEach((ev) => {
					const div = document.createElement("div");
					div.className =
						"d-flex justify-content-between align-items-center mb-2";
					div.innerHTML = `
          <div>
            <div style="font-weight:600">${ev.name}</div>
            <div class="muted small">${ev.participants.length} participants ‚Ä¢ ${
						ev.requiresApproval
							? "requires approval"
							: "auto-approve"
					}</div>
          </div>
          <div class="text-end">
            <button class="btn btn-sm btn-outline me-1" onclick="selectEvent('${
				ev.id
			}')">View</button>
            <button class="btn btn-sm btn-outline" onclick="openAssign('${
				ev.id
			}')">Assign</button>
          </div>
        `;
					managedEventsEl.appendChild(div);
				});
			}

			/*****************************************
			 * Select event -> display participants  *
			 *****************************************/
			function selectEvent(eventId) {
				selectedEvent = events.find((e) => e.id === eventId)
					? eventId
					: null;
				if (!selectedEvent) {
					selectedTitle.textContent = "Select an event";
					selectedMeta.textContent = "";
					participantsEl.innerHTML =
						'<div class="muted small">No event selected</div>';
					document.getElementById("assignCoordBtn").disabled = true;
					return;
				}
				const ev = events.find((e) => e.id === selectedEvent);
				selectedTitle.textContent = ev.name;
				selectedMeta.textContent = `${
					ev.participants.length
				} participant(s) ‚Ä¢ ${
					ev.requiresApproval ? "requires approval" : "no approval"
				}`;
				renderParticipants(ev);
				document.getElementById("assignCoordBtn").disabled =
					ev.participants.length === 0;
			}

			function renderParticipants(ev) {
				participantsEl.innerHTML = "";
				if (!ev || !ev.participants || ev.participants.length === 0) {
					participantsEl.innerHTML =
						'<div class="muted small">No participants</div>';
					return;
				}
				ev.participants.forEach((pid) => {
					const p = participants[pid] || { id: pid, name: pid };
					const row = document.createElement("div");
					row.className =
						"d-flex justify-content-between align-items-center mb-2";
					row.innerHTML = `
          <div>
            <div style="font-weight:600">${p.name}</div>
            <div class="muted small">${p.id} ‚Ä¢ ${p.email || ""}</div>
          </div>
          <div class="text-end">
            <button class="btn btn-sm btn-outline me-1" onclick="viewParticipant('${
				ev.id
			}','${p.id}')">View</button>
            <button class="btn btn-sm btn-danger" onclick="promptRemoveParticipant('${
				ev.id
			}','${p.id}')">Remove</button>
          </div>
        `;
					participantsEl.appendChild(row);
				});
				// show coordinators if any
				const evCoordinators = ev.studentCoordinators || [];
				if (evCoordinators.length) {
					const box = document.createElement("div");
					box.className = "mt-2 muted small";
					box.innerHTML = `<div style="font-weight:600">Student Coordinators</div><div>${evCoordinators
						.map((id) =>
							participants[id]
								? participants[id].name + " (" + id + ")"
								: id
						)
						.join(", ")}</div>`;
					participantsEl.appendChild(box);
				}
			}

			/*************************
			 * Approve / Reject flows
			 *************************/
			function handleApprove(approvalId) {
				const idx = pending.findIndex((p) => p.id === approvalId);
				if (idx === -1) return alert("Not found");
				const a = pending[idx];
				const ev = events.find((e) => e.id === a.eventId);
				if (!ev) return alert("Event missing");
				if (a.type === "participant") {
					const pid = a.submittedBy;
					if (!ev.participants.includes(pid))
						ev.participants.push(pid);
					logAction(`Approved participant ${pid} for ${ev.name}`);
				} else if (a.type === "team") {
					const members = a.details.match(/S\d+/g) || [];
					members.forEach((m) => {
						if (!ev.participants.includes(m))
							ev.participants.push(m);
					});
					logAction(
						`Approved team for ${ev.name}: ${members.join(", ")}`
					);
				}
				// remove approval
				pending.splice(idx, 1);
				renderApprovals();
				renderManagedEvents();
				if (selectedEvent === ev.id) renderParticipants(ev);
			}

			function handleReject(approvalId) {
				if (!confirm("Reject this request?")) return;
				const idx = pending.findIndex((p) => p.id === approvalId);
				if (idx === -1) return;
				const a = pending[idx];
				logAction(`Rejected ${a.type} request for event ${a.eventId}`);
				pending.splice(idx, 1);
				renderApprovals();
			}

			function openApproveModal(approvalId) {
				const a = pending.find((p) => p.id === approvalId);
				if (!a) return;
				const ev = events.find((e) => e.id === a.eventId);
				document.getElementById("modalApproveTitle").textContent =
					a.summary;
				document.getElementById("modalApproveBody").innerHTML = `
        <div><strong>Event:</strong> ${ev ? ev.name : a.eventId}</div>
        <div class="muted small"><strong>Type:</strong> ${a.type}</div>
        <div class="muted small"><strong>Submitted by:</strong> ${
			a.submittedBy
		} ‚Ä¢ ${a.when}</div>
        <div class="mt-2"><strong>Details:</strong><div class="muted small">${
			a.details
		}</div></div>
      `;
				document.getElementById("modalApproveBtn").onclick = () => {
					handleApprove(approvalId);
					bootstrap.Modal.getInstance(
						document.getElementById("modalApprove")
					).hide();
				};
				document.getElementById("modalReject").onclick = () => {
					handleReject(approvalId);
					bootstrap.Modal.getInstance(
						document.getElementById("modalApprove")
					).hide();
				};
				new bootstrap.Modal(
					document.getElementById("modalApprove")
				).show();
			}

			/********************************
			 * Assign student coordinator   *
			 * (teacher picks from participants)
			 ********************************/
			function openAssign(eventId) {
				const ev = events.find((e) => e.id === eventId);
				if (!ev) return alert("Event missing");
				const sel = document.getElementById("assignSelect");
				sel.innerHTML = "";
				if (!ev.participants || ev.participants.length === 0) {
					sel.innerHTML =
						'<option value="">-- no participants --</option>';
				} else {
					ev.participants.forEach((pid) => {
						const p = participants[pid] || { id: pid, name: pid };
						const opt = document.createElement("option");
						opt.value = pid;
						opt.textContent = `${p.name} (${pid})`;
						sel.appendChild(opt);
					});
				}
				document.getElementById(
					"assignInfo"
				).textContent = `Assign coordinator for: ${ev.name}`;
				document.getElementById("assignConfirm").onclick = () => {
					const chosen = sel.value;
					if (!chosen) return alert("Select a participant first");
					ev.studentCoordinators = ev.studentCoordinators || [];
					if (!ev.studentCoordinators.includes(chosen))
						ev.studentCoordinators.push(chosen);
					logAction(
						`Assigned ${chosen} as student coordinator for ${ev.name}`
					);
					new bootstrap.Modal(
						document.getElementById("modalAssign")
					).hide();
					if (selectedEvent === ev.id) renderParticipants(ev);
					renderManagedEvents();
				};
				new bootstrap.Modal(
					document.getElementById("modalAssign")
				).show();
			}

			document
				.getElementById("assignCoordBtn")
				.addEventListener("click", () => {
					if (!selectedEvent) return alert("Select an event first");
					openAssign(selectedEvent);
				});

			/***************************
			 * Remove participant flow  *
			 ***************************/
			function promptRemoveParticipant(eventId, participantId) {
				selectedParticipantToRemove = { eventId, participantId };
				document.getElementById(
					"modalRemoveBody"
				).textContent = `Remove ${participantId} from ${eventId}? This cannot be undone.`;
				document.getElementById("removeConfirm").onclick =
					confirmRemoveParticipant;
				new bootstrap.Modal(
					document.getElementById("modalRemove")
				).show();
			}

			function confirmRemoveParticipant() {
				if (!selectedParticipantToRemove) return;
				const { eventId, participantId } = selectedParticipantToRemove;
				const ev = events.find((e) => e.id === eventId);
				if (!ev) return;
				ev.participants = ev.participants.filter(
					(p) => p !== participantId
				);
				// also remove from coordinators if present
				if (ev.studentCoordinators)
					ev.studentCoordinators = ev.studentCoordinators.filter(
						(c) => c !== participantId
					);
				logAction(
					`Removed participant ${participantId} from ${ev.name}`
				);
				new bootstrap.Modal(
					document.getElementById("modalRemove")
				).hide();
				if (selectedEvent === eventId) renderParticipants(ev);
				renderManagedEvents();
				selectedParticipantToRemove = null;
			}

			function viewParticipant(eventId, participantId) {
				const p = participants[participantId] || {
					id: participantId,
					name: participantId,
				};
				alert(`${p.name}\nID: ${p.id}\nEmail: ${p.email || "‚Äî"}`);
			}

			/***********************
			 * Init & UI bindings  *
			 ***********************/
			document
				.getElementById("btnRefresh")
				.addEventListener("click", () => {
					renderApprovals();
					renderManagedEvents();
					if (selectedEvent) {
						const ev = events.find((e) => e.id === selectedEvent);
						if (ev) renderParticipants(ev);
					}
				});
			document
				.getElementById("filterEvent")
				.addEventListener("input", renderApprovals);
			document
				.getElementById("globalSearch")
				.addEventListener("keydown", (e) => {
					if (e.key === "Enter") {
						document.getElementById("filterEvent").value =
							e.target.value;
						renderApprovals();
					}
				});
			document
				.getElementById("logoutTop")
				.addEventListener("click", () => {
					if (confirm("Logout?")) alert("Logged out (demo)");
				});
			document
				.getElementById("logoutSide")
				.addEventListener("click", () => {
					if (confirm("Logout?")) alert("Logged out (demo)");
				});

			// Start with only relevant pending approvals kept
			function sanitizePending() {
				pending = pending.filter((a) => {
					const ev = events.find((e) => e.id === a.eventId);
					return ev && approvalsFilter(ev); // only keep approvals for events teacher manages that require approval and teamParticipation
				});
			}

			function init() {
				sanitizePending();
				renderApprovals();
				renderManagedEvents();
			}

			init();
		</script>
	</body>
</html>
