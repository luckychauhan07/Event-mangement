<!-- File: events.html (styling matched to your original, prototype ‚Äî no localStorage) -->
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Event Ease ‚Äî Events (CRUD)</title>

		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="../style.css" />
		<link rel="stylesheet" href="admin-common.css" />

		<style>
			/* keep your original visual tokens */

			.app-shell {
				display: flex;
				min-height: calc(100vh - var(--header-height));
			}
			.app-sidebar {
				width: var(--sidebar-width);
				background: linear-gradient(
					180deg,
					var(--sidebar-gradient-start),
					var(--sidebar-gradient-end)
				);
				color: #fff;
				padding: 28px 20px;
				display: flex;
				flex-direction: column;
				box-shadow: var(--shadow-md);
			}
			.kpi-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 14px;
				margin-bottom: 18px;
			}
			.app-main {
				flex: 1;
				padding: 32px;
			}
			.card-compact {
				background: #fff;
				padding: 16px;
				border-radius: 10px;
				box-shadow: var(--shadow-md);
			}
			.muted {
				color: #6b7280;
			}
			.small {
				font-size: 0.85rem;
			}
			.cursor {
				cursor: pointer;
			}
			.table-actions .btn {
				padding: 6px 8px;
			}
			.small-gap {
				gap: 8px;
			}
			@media (max-width: 991px) {
				.app-sidebar {
					display: none;
				}
				.app-main {
					padding: 24px;
				}
			}
		</style>
	</head>
	<body>
		<!-- HEADER (shared) -->
		<header class="topbar">
			<a
				class="d-flex align-items-center text-decoration-none"
				href="admin.html"
				aria-label="Event Ease Home"
			>
				<div class="logo"><img src="../logo.svg" alt="EE" /></div>
				<div
					style="
						margin-left: 10px;
						font-weight: 700;
						color: var(--text-dark);
					"
				>
					Event Ease
				</div>
			</a>

			<div class="d-flex align-items-center gap-3">
				<div class="d-none d-md-block" style="min-width: 280px">
					<input
						id="globalSearch"
						class="form-control form-control-sm"
						placeholder="Search (events, users, IDs) ‚Äî /"
					/>
				</div>
				<a
					href="notifications.html"
					class="position-relative btn btn-light"
					title="Notifications"
				>
					üîî
					<span
						id="adminNotifCount"
						class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
						style="font-size: 11px"
					>
						2
					</span>
				</a>

				<div class="dropdown">
					<button
						class="btn d-flex align-items-center gap-2"
						data-bs-toggle="dropdown"
						aria-expanded="false"
					>
						<div
							class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
							style="width: 36px; height: 36px"
						>
							AD
						</div>
						<div class="d-none d-md-block text-start">
							<div style="font-weight: 600">Admin</div>
							<div class="small muted">admin@college.edu</div>
						</div>
					</button>
					<ul class="dropdown-menu dropdown-menu-end">
						<li>
							<a class="dropdown-item" href="profile.html"
								>Profile</a
							>
						</li>
						<li>
							<a class="dropdown-item" href="settings.html"
								>Settings</a
							>
						</li>
						<li><hr class="dropdown-divider" /></li>
						<li>
							<a
								class="dropdown-item text-danger"
								href="#"
								id="logoutBtn"
								>Logout</a
							>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div class="app-shell">
			<!-- SIDEBAR -->
			<aside class="app-sidebar d-none d-lg-flex">
				<nav class="sidebar-nav">
					<a href="admin.html">üè† Home</a>
					<a href="users.html">üë• Users</a>
					<a class="active" href="events.html">üìÖ Events</a>
					<a href="add-event.html">‚ûï Add Event</a>
					<a href="reports.html">üìä Reports</a>
					<a href="notifications.html">üîî Notifications</a>
					<a href="profile.html">üë§ Profile</a>
				</nav>
				<div class="sidebar-footer mt-auto">
					<a
						id="logoutSide"
						class="text-danger"
						style="display: block; margin-bottom: 12px"
						>üîí Logout</a
					>
					v1.0 ‚Ä¢ ¬© <span id="yearEvents"></span>
				</div>
			</aside>

			<!-- MAIN -->
			<main class="app-main">
				<div class="card-compact mb-4">
					<h6>Quick stats</h6>
					<div class="kpi-grid">
						<div class="card-compact">
							<div class="muted">Total events</div>
							<div
								style="font-weight: 700; font-size: 20px"
								id="statTotal"
							>
								0
							</div>
						</div>

						<div class="card-compact">
							<div class="muted">Ongoing</div>
							<div
								id="statOngoing"
								style="font-weight: 700; font-size: 20px"
							>
								0
							</div>
						</div>
						<div class="card-compact">
							<div class="muted">Upcoming</div>
							<div
								id="statUpcoming"
								style="font-weight: 700; font-size: 20px"
							>
								0
							</div>
						</div>
					</div>
				</div>

				<div
					class="d-flex justify-content-between align-items-center mb-3"
				>
					<div>
						<h4 class="mb-0">Events</h4>
						<div class="muted">
							Create, edit, assign coordinators and manage events
						</div>
					</div>

					<div class="d-flex small-gap">
						<div class="input-group input-group-sm">
							<input
								id="tableSearch"
								class="form-control"
								placeholder="Search events..."
							/>
							<button class="btn btn-outline" id="clearSearch">
								‚úñ
							</button>
						</div>
						<select
							id="filterStatus"
							class="form-select form-select-sm"
						>
							<option value="all">All status</option>
							<option value="upcoming">Upcoming</option>
							<option value="ongoing">Ongoing</option>
							<option value="completed">Completed</option>
						</select>
						<button class="btn btn-primary" id="openCreate">
							+ Create
						</button>
					</div>
				</div>

				<div class="card-compact mb-3">
					<div
						class="d-flex justify-content-between align-items-center mb-2"
					>
						<div class="muted">Events list</div>
						<div class="d-flex gap-2">
							<button
								class="btn btn-outline btn-sm"
								id="bulkDeleteBtn"
							>
								Delete Selected
							</button>
							<button
								class="btn btn-outline btn-sm"
								id="bulkExportBtn"
							>
								Export Selected
							</button>
						</div>
					</div>

					<div class="table-responsive">
						<table class="table table-hover align-middle">
							<thead>
								<tr>
									<th style="width: 36px">
										<input type="checkbox" id="selectAll" />
									</th>
									<th data-sort="name" class="cursor">
										Event
									</th>
									<th data-sort="date">Date</th>
									<th>Venue</th>
									<th>Capacity</th>
									<th>Coordinator</th>
									<th>Status</th>
									<th class="text-end">Actions</th>
								</tr>
							</thead>
							<tbody id="eventsTbody"></tbody>
						</table>
					</div>

					<div
						class="d-flex justify-content-between align-items-center mt-2"
					>
						<div class="muted">
							Showing <span id="showingRange">0</span>
						</div>
						<nav>
							<ul
								class="pagination pagination-sm mb-0"
								id="pagination"
							></ul>
						</nav>
					</div>
				</div>
			</main>
		</div>

		<!-- Modals: Create/Edit, View (light), Confirm Delete -->
		<div class="modal fade" id="confirmModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Confirm</h5>
						<button
							class="btn-close"
							data-bs-dismiss="modal"
						></button>
					</div>
					<div class="modal-body" id="confirmBody"></div>
					<div class="modal-footer">
						<button class="btn btn-outline" data-bs-dismiss="modal">
							Cancel
						</button>
						<button class="btn btn-danger" id="confirmYes">
							Yes, delete
						</button>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			// In-memory prototype dataset (both pages use the same hard-coded initial data for prototype)
			// === ADMIN-CREATED EVENT (PROTOTYPE SOURCE) ===
			const ADMIN_EVENTS = [
				{
					id: "E101",

					// BASIC INFO
					title: "Ideathon-2025",
					subtitle: "Explore innovative minds",
					description:
						"This event is a 24-hour live coding ideathon.",
					category: "Technical",
					visibility: "Public",

					// TYPE & FEES
					eventType: "paid", // free | paid
					entryFee: 200,
					feeMode: "per_person", // per_person | per_team

					// MODE & LOCATION
					mode: "Offline",
					venue: "B-block",
					rooms: "F-104 Seminar Hall",
					onlineLink: "",

					// TIME
					startAt: "2025-12-21T01:56",
					endAt: "2025-12-22T01:56",

					// REGISTRATION
					registrationRequired: "Yes",
					registrationType: "Open",
					regStart: "2025-12-15T01:57",
					regEnd: "2025-12-18T01:57",
					participantLimit: 200,

					// TEAM
					teamsEnabled: "Yes",
					teamJoinMode: "Open",
					teamMin: 1,
					teamMax: 4,

					// AUDIENCE
					audienceRole: "Students",
					audienceDepartment: "",
					audienceCourse: "",
					ageRestriction: "",

					// ORGANIZATION
					organizer: "Tech Club",
					primaryCoordinator: "Lucky Chauhan",
					coordEmail: "",
					coordPhone: "",

					// FACILITIES
					catering: "No",
					cateringDetails: "",
					equipment: "",
					securityLevel: "High",

					// MEDIA
					poster: "problem.jpg",
					promoVideo: "",
					documents: "Object-Oriented-System-Design.pdf",

					// OPERATIONAL (not from creation form)
					participantsEnrolled: 87,
				},
				{
					id: "E102",

					// BASIC INFO
					title: "Ideathon-2025",
					subtitle: "Explore innovative minds",
					description:
						"This event is a 24-hour live coding ideathon.",
					category: "Technical",
					visibility: "Public",

					// TYPE & FEES
					eventType: "paid", // free | paid
					entryFee: 200,
					feeMode: "per_person", // per_person | per_team

					// MODE & LOCATION
					mode: "Offline",
					venue: "B-block",
					rooms: "F-104 Seminar Hall",
					onlineLink: "",

					// TIME
					startAt: "2025-12-21T01:56",
					endAt: "2025-12-22T01:56",

					// REGISTRATION
					registrationRequired: "Yes",
					registrationType: "Open",
					regStart: "2025-12-15T01:57",
					regEnd: "2025-12-18T01:57",
					participantLimit: 200,

					// TEAM
					teamsEnabled: "Yes",
					teamJoinMode: "Open",
					teamMin: 1,
					teamMax: 4,

					// AUDIENCE
					audienceRole: "Students",
					audienceDepartment: "",
					audienceCourse: "",
					ageRestriction: "",

					// ORGANIZATION
					organizer: "Tech Club",
					primaryCoordinator: "Lucky Chauhan",
					coordEmail: "",
					coordPhone: "",

					// FACILITIES
					catering: "No",
					cateringDetails: "",
					equipment: "",
					securityLevel: "High",

					// MEDIA
					poster: "problem.jpg",
					promoVideo: "",
					documents: "Object-Oriented-System-Design.pdf",

					// OPERATIONAL (not from creation form)
					participantsEnrolled: 87,
				},
			];
			let events = ADMIN_EVENTS;

			// UI state
			let page = 1,
				perPage = 5,
				sortKey = "startAt",
				sortDir = "asc";

			const tbody = document.getElementById("eventsTbody");
			const pagination = document.getElementById("pagination");
			const showingRange = document.getElementById("showingRange");
			const statTotal = document.getElementById("statTotal");
			const statUpcoming = document.getElementById("statUpcoming");
			const statOngoing = document.getElementById("statOngoing");
			const yearEvents = document.getElementById("yearEvents");
			yearEvents.textContent = new Date().getFullYear();

			function uid(prefix = "E") {
				return prefix + Math.floor(Math.random() * 9000 + 1000);
			}
			function formatDate(d) {
				const dt = new Date(d);
				return dt.toLocaleString();
			}
			function getEventStatus(ev) {
				const now = new Date();
				const start = new Date(ev.startAt || ev.date);
				const end = new Date(ev.endAt || ev.date);

				if (now < start) return "Upcoming";
				if (now >= start && now <= end) return "Ongoing";
				return "Completed";
			}

			function renderTable() {
				const search = (
					document.getElementById("tableSearch").value || ""
				).toLowerCase();
				const statusFilter =
					document.getElementById("filterStatus").value;
				let list = events.slice();

				if (statusFilter !== "all")
					list = list.filter(
						(e) => getEventStatus(e).toLowerCase() === statusFilter
					);

				if (search)
					list = list.filter((e) =>
						(
							e.title +
							" " +
							e.subtitle +
							" " +
							e.id +
							" " +
							e.venue +
							" " +
							(e.primaryCoordinator || "")
						)

							.toLowerCase()
							.includes(search)
					);

				list.sort((a, b) => {
					let A = a[sortKey],
						B = b[sortKey];
					if (sortKey === "date") {
						A = new Date(A);
						B = new Date(B);
					}
					if (A < B) return sortDir === "asc" ? -1 : 1;
					if (A > B) return sortDir === "asc" ? 1 : -1;
					return 0;
				});

				const total = list.length;
				const pages = Math.max(1, Math.ceil(total / perPage));
				if (page > pages) page = pages;
				const start = (page - 1) * perPage;
				const pageList = list.slice(start, start + perPage);

				tbody.innerHTML = "";
				pageList.forEach((ev) => {
					const tr = document.createElement("tr");
					tr.innerHTML = `
						<td><input type="checkbox" class="row-check" data-id="${ev.id}"></td>
						<td><div style="font-weight:600">${ev.title}</div><div class="small muted">${
						ev.subtitle
					}</div></td>
						<td>
						<div>${new Date(ev.startAt).toLocaleString()}</div>
						<div class="small muted">‚Üí ${new Date(ev.endAt).toLocaleString()}</div>
						</td>

						<td>
						<div>${ev.mode}</div>
						<div class="small muted">
							${ev.mode === "Online" ? ev.onlineLink : ev.venue}
						</div>
						</td>

						<td>${ev.participantsEnrolled}/${ev.participantLimit}</td>
						<td>${ev.primaryCoordinator || "-"}</td>
						<td>
						<span class="badge ${
							getEventStatus(ev) === "Ongoing"
								? "bg-success"
								: getEventStatus(ev) === "Upcoming"
								? "bg-warning text-dark"
								: "bg-secondary"
						}">
							${getEventStatus(ev)}
						</span>
						</td>

						<td class="text-end">
							<a class="btn btn-sm btn-outline" href="event-details.html?id=${encodeURIComponent(
								ev.id
							)}">View details</a>
						</td>`;
					tbody.appendChild(tr);
				});

				renderPagination(pages);
				showingRange.textContent = `${start + 1}-${
					start + pageList.length
				} of ${total}`;
				statTotal.textContent = events.length;
				statTotal.textContent = events.length;
				statUpcoming.textContent = events.filter(
					(e) => getEventStatus(e) === "Upcoming"
				).length;
				statOngoing.textContent = events.filter(
					(e) => getEventStatus(e) === "Ongoing"
				).length;
			}

			function renderPagination(pages) {
				pagination.innerHTML = "";
				const makeItem = (n, label) => {
					const li = document.createElement("li");
					li.className = "page-item" + (n === page ? " active" : "");
					const a = document.createElement("a");
					a.className = "page-link";
					a.href = "#";
					a.textContent = label || n;
					a.onclick = (e) => {
						e.preventDefault();
						page = n;
						renderTable();
					};
					li.appendChild(a);
					return li;
				};
				const prev = document.createElement("li");
				prev.className = "page-item" + (page === 1 ? " disabled" : "");
				const pa = document.createElement("a");
				pa.className = "page-link";
				pa.href = "#";
				pa.textContent = "‚Äπ";
				pa.onclick = (e) => {
					e.preventDefault();
					if (page > 1) {
						page--;
						renderTable();
					}
				};
				prev.appendChild(pa);
				pagination.appendChild(prev);
				const start = Math.max(1, page - 2);
				const end = Math.min(pages, start + 4);
				for (let i = start; i <= end; i++)
					pagination.appendChild(makeItem(i));
				const next = document.createElement("li");
				next.className =
					"page-item" + (page === pages ? " disabled" : "");
				const na = document.createElement("a");
				na.className = "page-link";
				na.href = "#";
				na.textContent = "‚Ä∫";
				na.onclick = (e) => {
					e.preventDefault();
					if (page < pages) {
						page++;
						renderTable();
					}
				};
				next.appendChild(na);
				pagination.appendChild(next);
			}

			// Create/Edit (in-memory)
			document
				.getElementById("openCreate")
				.addEventListener("click", () => {
					window.location.href = "add-event.html";
					document.getElementById("eventModalTitle").textContent =
						"Create Event";
					document.getElementById("evtId").value = "";
					document.getElementById("evtName").value = "";
					document.getElementById("evtVenue").value = "";
					document.getElementById("evtDate").value = "";
					document.getElementById("evtCapacity").value = "100";
					document.getElementById("evtCoordinator").value = "";
					document.getElementById("evtDesc").value = "";
					document
						.getElementById("eventForm")
						.classList.remove("was-validated");
					new bootstrap.Modal(
						document.getElementById("eventModal")
					).show();
				});
			// Delete prompt (used for bulk delete)
			function promptDelete(id) {
				document.getElementById("confirmBody").textContent =
					"Delete " + id + "? This action cannot be undone.";
				new bootstrap.Modal(
					document.getElementById("confirmModal")
				).show();
				document.getElementById("confirmYes").onclick = () => {
					events = events.filter((e) => e.id !== id);
					renderTable();
				};
			}

			// bulk
			document
				.getElementById("selectAll")
				.addEventListener("change", function () {
					document
						.querySelectorAll(".row-check")
						.forEach((cb) => (cb.checked = this.checked));
				});
			document
				.getElementById("bulkDeleteBtn")
				.addEventListener("click", function () {
					const ids = Array.from(
						document.querySelectorAll(".row-check:checked")
					).map((n) => n.dataset.id);
					if (ids.length === 0) return alert("Select rows first");
					if (!confirm("Delete " + ids.length + " events?")) return;
					events = events.filter((e) => !ids.includes(e.id));
					renderTable();
				});
			document
				.getElementById("bulkExportBtn")
				.addEventListener("click", function () {
					const ids = Array.from(
						document.querySelectorAll(".row-check:checked")
					).map((n) => n.dataset.id);
					const rows = events.filter((e) => ids.includes(e.id));
					if (rows.length === 0) return alert("Select rows first");
					exportCSV(rows, "events-selected.csv");
				});

			// 			function exportCSV(rows, filename='export.csv'){ const cols=['id','name','date','venue','capacity','coordinator','enrolled','status','desc']; const csv=[cols.join(',')].concat(rows.map(r=>cols.map(c=>`"${String(r[c]??'').replace(/"/g,'""')}"`).join(','))).join('
			// ');

			//  const blob=new Blob([csv],{type:'text/csv'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }

			// search/filter controls
			document
				.getElementById("tableSearch")
				.addEventListener("input", () => {
					page = 1;
					renderTable();
				});
			document
				.getElementById("clearSearch")
				.addEventListener("click", () => {
					document.getElementById("tableSearch").value = "";
					renderTable();
				});
			document
				.getElementById("filterStatus")
				.addEventListener("change", () => {
					page = 1;
					renderTable();
				});
			document
				.getElementById("globalSearch")
				.addEventListener("keyup", (e) => {
					if (e.key === "Enter") {
						document.getElementById("tableSearch").value =
							e.target.value;
						renderTable();
					}
				});

			// column sort
			document.querySelectorAll("th[data-sort]").forEach((th) => {
				th.style.cursor = "pointer";
				th.addEventListener("click", () => {
					const key = th.getAttribute("data-sort");
					if (sortKey === key)
						sortDir = sortDir === "asc" ? "desc" : "asc";
					else {
						sortKey = key;
						sortDir = "asc";
					}
					renderTable();
				});
			});

			// init
			renderTable();
		</script>
	</body>
</html>
