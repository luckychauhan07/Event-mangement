<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Event Ease ‚Äî Events (CRUD)</title>

		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="../style.css" />

		<style>
			body {
				font-family: Inter, system-ui, Arial;
				background: var(--bg-light);
				color: var(--text-dark);
			}
			.app-shell {
				display: flex;
				min-height: calc(100vh - var(--header-height));
			}
			.app-sidebar {
				width: var(--sidebar-width);
				background: linear-gradient(180deg, var(--sidebar-gradient-start), var(--sidebar-gradient-end));
				color: #fff;
				padding: 28px 20px;
				display: flex;
				flex-direction: column;
				box-shadow: var(--shadow-md);
			}
			.app-main {
				flex: 1;
				padding: 32px;
			}
			.table-actions .btn {
				padding: 6px 8px;
			}
			.small-gap {
				gap: 8px;
			}
			@media (max-width: 991px) {
				.app-sidebar {
					display: none;
				}
				.app-main {
					padding: 24px;
				}
			}
		</style>
	</head>
	<body>
		<!-- HEADER (shared) -->
		<header class="topbar">
			<a
				class="d-flex align-items-center text-decoration-none"
				href="admin.html"
			>
				<div class="logo-mark">EE</div>
				<div style="margin-left: 10px; font-weight: 700; color: var(--text-dark);">
					Event Ease
				</div>
			</a>

			<div class="d-flex align-items-center gap-3">
				<input
					id="globalSearch"
					class="form-control form-control-sm d-none d-md-block"
					style="min-width: 240px"
					placeholder="Search events / id / venue"
				/>
				<div class="dropdown">
					<button
						class="btn d-flex align-items-center gap-2"
						data-bs-toggle="dropdown"
					>
						<div
							class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
							style="width: 36px; height: 36px"
						>
							AD
						</div>
					</button>
					<ul class="dropdown-menu dropdown-menu-end">
						<li>
							<a class="dropdown-item" href="profile.html"
								>Profile</a
							>
						</li>
						<li>
							<a class="dropdown-item" href="admin-home.html"
								>Home</a
							>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div class="app-shell">
			<!-- SIDEBAR -->
			<aside class="app-sidebar d-none d-lg-flex">
				<nav class="sidebar-nav">
					<a href="admin.html"
						>üè† Home</a
					>
					<a href="users.html"
						>üë• Users</a
					>
					<a
						class="active"
						href="events.html"
						>üìÖ Events</a
					>
					<a href="reports.html"
						>üìä Reports</a
					>
					<a href="profile.html"
						>üë§ Profile</a
					>
				</nav>
				<div class="sidebar-footer">
					<a id="logoutSide" class="text-danger" style="display: block; margin-bottom: 12px;"
						>üîí Logout</a
					>
					v1.0 ‚Ä¢ ¬© <span id="yearEvents"></span>
				</div>
			</aside>

			<!-- MAIN -->
			<main class="app-main">
				<div
					class="d-flex justify-content-between align-items-center mb-3"
				>
					<div>
						<h4 class="mb-0">Events</h4>
						<div class="muted">
							Create, edit, assign coordinators and manage events
						</div>
					</div>
					<div class="d-flex small-gap">
						<div class="input-group input-group-sm">
							<input
								id="tableSearch"
								class="form-control"
								placeholder="Search events..."
							/>
							<button class="btn btn-outline" id="clearSearch">
								‚úñ
							</button>
						</div>
						<select
							id="filterStatus"
							class="form-select form-select-sm"
						>
							<option value="all">All status</option>
							<option value="upcoming">Upcoming</option>
							<option value="ongoing">Ongoing</option>
							<option value="completed">Completed</option>
						</select>
						<button class="btn btn-primary" id="openCreate">
							+ Create
						</button>
					</div>
				</div>

				<div class="card-compact mb-3">
					<div
						class="d-flex justify-content-between align-items-center mb-2"
					>
						<div class="muted">Events list</div>
						<div class="d-flex gap-2">
							<button
								class="btn btn-outline btn-sm"
								id="bulkDeleteBtn"
							>
								Delete Selected
							</button>
							<button
								class="btn btn-outline btn-sm"
								id="bulkExportBtn"
							>
								Export Selected
							</button>
						</div>
					</div>

					<div class="table-responsive">
						<table class="table table-hover align-middle">
							<thead>
								<tr>
									<th style="width: 36px">
										<input type="checkbox" id="selectAll" />
									</th>
									<th data-sort="name" class="cursor">
										Event
									</th>
									<th data-sort="date">Date</th>
									<th>Venue</th>
									<th>Capacity</th>
									<th>Coordinator</th>
									<th>Status</th>
									<th class="text-end">Actions</th>
								</tr>
							</thead>
							<tbody id="eventsTbody"></tbody>
						</table>
					</div>

					<div
						class="d-flex justify-content-between align-items-center mt-2"
					>
						<div class="muted">
							Showing <span id="showingRange">0</span>
						</div>
						<nav>
							<ul
								class="pagination pagination-sm mb-0"
								id="pagination"
							></ul>
						</nav>
					</div>
				</div>

				<div class="card-compact">
					<h6>Quick stats</h6>
					<div class="d-flex gap-3 mt-2">
						<div>
							<div class="muted">Total events</div>
							<div style="font-weight: 700" id="statTotal">0</div>
						</div>
						<div>
							<div class="muted">Upcoming</div>
							<div style="font-weight: 700" id="statUpcoming">
								0
							</div>
						</div>
						<div>
							<div class="muted">Ongoing</div>
							<div style="font-weight: 700" id="statOngoing">
								0
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>

		<!-- Modals: Create/Edit, View, Confirm Delete, Assign Coordinator -->
		<div class="modal fade" id="eventModal" tabindex="-1">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<form id="eventForm" class="needs-validation" novalidate>
						<div class="modal-header">
							<h5 class="modal-title" id="eventModalTitle">
								Create Event
							</h5>
							<button
								class="btn-close"
								data-bs-dismiss="modal"
							></button>
						</div>
						<div class="modal-body">
							<input type="hidden" id="evtId" />
							<div class="row g-3">
								<div class="col-md-6">
									<label class="form-label">Name</label
									><input
										id="evtName"
										class="form-control"
										required
									/>
								</div>
								<div class="col-md-6">
									<label class="form-label">Venue</label
									><input
										id="evtVenue"
										class="form-control"
										required
									/>
								</div>
								<div class="col-md-6">
									<label class="form-label">Date & Time</label
									><input
										id="evtDate"
										type="datetime-local"
										class="form-control"
										required
									/>
								</div>
								<div class="col-md-6">
									<label class="form-label">Capacity</label
									><input
										id="evtCapacity"
										type="number"
										class="form-control"
										min="1"
										value="100"
										required
									/>
								</div>
								<div class="col-md-6">
									<label class="form-label">Coordinator</label
									><input
										id="evtCoordinator"
										class="form-control"
									/>
								</div>
								<div class="col-12">
									<label class="form-label">Description</label
									><textarea
										id="evtDesc"
										class="form-control"
										rows="3"
									></textarea>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button
								class="btn btn-outline"
								data-bs-dismiss="modal"
							>
								Cancel</button
							><button class="btn btn-primary" id="saveEvent">
								Save
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<div class="modal fade" id="viewModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="viewTitle">Event</h5>
						<button
							class="btn-close"
							data-bs-dismiss="modal"
						></button>
					</div>
					<div class="modal-body" id="viewBody"></div>
					<div class="modal-footer">
						<button class="btn btn-outline" data-bs-dismiss="modal">
							Close
						</button>
					</div>
				</div>
			</div>
		</div>

		<div class="modal fade" id="confirmModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Confirm</h5>
						<button
							class="btn-close"
							data-bs-dismiss="modal"
						></button>
					</div>
					<div class="modal-body" id="confirmBody"></div>
					<div class="modal-footer">
						<button class="btn btn-outline" data-bs-dismiss="modal">
							Cancel</button
						><button class="btn btn-danger" id="confirmYes">
							Yes, delete
						</button>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
		<script>
			// Demo in-memory dataset
			let events = [
				{
					id: "E001",
					name: "Hackathon 2025",
					date: "2025-12-05T10:00",
					venue: "Auditorium A",
					capacity: 100,
					coordinator: "Prof Rao",
					enrolled: 45,
					status: "Ongoing",
					desc: "24-hour coding event",
				},
				{
					id: "E002",
					name: "Tech Workshop",
					date: "2025-12-10T14:00",
					venue: "Lab 101",
					capacity: 50,
					coordinator: "Dr Sharma",
					enrolled: 23,
					status: "Upcoming",
					desc: "Hands-on workshop",
				},
				{
					id: "E003",
					name: "Cultural Night",
					date: "2025-12-15T18:00",
					venue: "Hall B",
					capacity: 200,
					coordinator: "Ms Gupta",
					enrolled: 0,
					status: "Upcoming",
					desc: "Performances & music",
				},
				{
					id: "E004",
					name: "AI Seminar",
					date: "2025-12-20T11:00",
					venue: "Room 204",
					capacity: 150,
					coordinator: "Prof Rao",
					enrolled: 120,
					status: "Upcoming",
					desc: "Invited talk on AI ethics",
				},
			];

			// UI state
			let page = 1,
				perPage = 5,
				sortKey = "date",
				sortDir = "asc";

			// DOM refs
			const tbody = document.getElementById("eventsTbody");
			const pagination = document.getElementById("pagination");
			const showingRange = document.getElementById("showingRange");
			const statTotal = document.getElementById("statTotal");
			const statUpcoming = document.getElementById("statUpcoming");
			const statOngoing = document.getElementById("statOngoing");
			const yearEvents = document.getElementById("yearEvents");

			yearEvents.textContent = new Date().getFullYear();

			// Helpers
			function uid(prefix = "E") {
				return prefix + Math.floor(Math.random() * 9000 + 1000);
			}
			function formatDate(d) {
				const dt = new Date(d);
				return dt.toLocaleString();
			}

			// Render table with filters/search/sort/pagination
			function renderTable() {
				const search = (
					document.getElementById("tableSearch").value || ""
				).toLowerCase();
				const statusFilter =
					document.getElementById("filterStatus").value;
				let list = events.slice();

				// filter
				if (statusFilter !== "all")
					list = list.filter(
						(e) => e.status.toLowerCase() === statusFilter
					);
				if (search)
					list = list.filter((e) =>
						(
							e.name +
							" " +
							e.id +
							" " +
							e.venue +
							" " +
							(e.coordinator || "")
						)
							.toLowerCase()
							.includes(search)
					);

				// sort
				list.sort((a, b) => {
					let A = a[sortKey],
						B = b[sortKey];
					if (sortKey === "date") {
						A = new Date(A);
						B = new Date(B);
					}
					if (A < B) return sortDir === "asc" ? -1 : 1;
					if (A > B) return sortDir === "asc" ? 1 : -1;
					return 0;
				});

				// pagination
				const total = list.length;
				const pages = Math.max(1, Math.ceil(total / perPage));
				if (page > pages) page = pages;
				const start = (page - 1) * perPage;
				const pageList = list.slice(start, start + perPage);

				tbody.innerHTML = "";
				pageList.forEach((ev) => {
					const tr = document.createElement("tr");
					tr.innerHTML = `
          <td><input type="checkbox" class="row-check" data-id="${ev.id}"></td>
          <td><div style="font-weight:600">${
				ev.name
			}</div><div class="small muted">${ev.id}</div></td>
          <td>${formatDate(ev.date)}</td>
          <td>${ev.venue}</td>
          <td>${ev.enrolled}/${ev.capacity}</td>
          <td>${ev.coordinator || "-"}</td>
          <td><span class="badge ${
				ev.status.toLowerCase() === "ongoing"
					? "bg-success"
					: "bg-secondary"
			}">${ev.status}</span></td>
          <td class="text-end">
            <button class="btn btn-sm btn-outline me-1" onclick="viewEvent('${
				ev.id
			}')">View</button>
            <button class="btn btn-sm btn-outline me-1" onclick="editEvent('${
				ev.id
			}')">Edit</button>
            <button class="btn btn-sm btn-danger" onclick="promptDelete('${
				ev.id
			}')">Delete</button>
          </td>`;
					tbody.appendChild(tr);
				});

				// pagination UI
				renderPagination(pages);
				showingRange.textContent = `${start + 1}-${
					start + pageList.length
				} of ${total}`;
				statTotal.textContent = events.length;
				statUpcoming.textContent = events.filter(
					(e) => e.status.toLowerCase() === "upcoming"
				).length;
				statOngoing.textContent = events.filter(
					(e) => e.status.toLowerCase() === "ongoing"
				).length;
			}

			function renderPagination(pages) {
				pagination.innerHTML = "";
				const makeItem = (n, label) => {
					const li = document.createElement("li");
					li.className = "page-item" + (n === page ? " active" : "");
					const a = document.createElement("a");
					a.className = "page-link";
					a.href = "#";
					a.textContent = label || n;
					a.onclick = (e) => {
						e.preventDefault();
						page = n;
						renderTable();
					};
					li.appendChild(a);
					return li;
				};
				// prev
				const prev = document.createElement("li");
				prev.className = "page-item" + (page === 1 ? " disabled" : "");
				const pa = document.createElement("a");
				pa.className = "page-link";
				pa.href = "#";
				pa.textContent = "‚Äπ";
				pa.onclick = (e) => {
					e.preventDefault();
					if (page > 1) {
						page--;
						renderTable();
					}
				};
				prev.appendChild(pa);
				pagination.appendChild(prev);
				// pages (limit 5)
				const start = Math.max(1, page - 2);
				const end = Math.min(pages, start + 4);
				for (let i = start; i <= end; i++)
					pagination.appendChild(makeItem(i));
				// next
				const next = document.createElement("li");
				next.className =
					"page-item" + (page === pages ? " disabled" : "");
				const na = document.createElement("a");
				na.className = "page-link";
				na.href = "#";
				na.textContent = "‚Ä∫";
				na.onclick = (e) => {
					e.preventDefault();
					if (page < pages) {
						page++;
						renderTable();
					}
				};
				next.appendChild(na);
				pagination.appendChild(next);
			}

			// CRUD actions
			document
				.getElementById("openCreate")
				.addEventListener("click", () => {
					document.getElementById("eventModalTitle").textContent =
						"Create Event";
					document.getElementById("evtId").value = "";
					document.getElementById("evtName").value = "";
					document.getElementById("evtVenue").value = "";
					document.getElementById("evtDate").value = "";
					document.getElementById("evtCapacity").value = 100;
					document.getElementById("evtCoordinator").value = "";
					document.getElementById("evtDesc").value = "";
					new bootstrap.Modal(
						document.getElementById("eventModal")
					).show();
				});

			document
				.getElementById("saveEvent")
				.addEventListener("click", (e) => {
					e.preventDefault();
					const form = document.getElementById("eventForm");
					if (!form.checkValidity()) {
						form.classList.add("was-validated");
						return;
					}
					const id = document.getElementById("evtId").value || uid();
					const payload = {
						id,
						name: document.getElementById("evtName").value.trim(),
						venue: document.getElementById("evtVenue").value.trim(),
						date: document.getElementById("evtDate").value,
						capacity: parseInt(
							document.getElementById("evtCapacity").value || 0,
							10
						),
						coordinator: document
							.getElementById("evtCoordinator")
							.value.trim(),
						enrolled: 0,
						status: "Upcoming",
						desc: document.getElementById("evtDesc").value.trim(),
					};
					const idx = events.findIndex((x) => x.id === id);
					if (idx >= 0) events[idx] = { ...events[idx], ...payload };
					else events.unshift(payload);
					bootstrap.Modal.getInstance(
						document.getElementById("eventModal")
					).hide();
					renderTable();
				});

			window.viewEvent = function (id) {
				const ev = events.find((e) => e.id === id);
				if (!ev) return alert("Not found");
				document.getElementById("viewTitle").textContent = ev.name;
				document.getElementById("viewBody").innerHTML = `
        <div><strong>ID:</strong> ${ev.id}</div>
        <div><strong>Date:</strong> ${formatDate(ev.date)}</div>
        <div><strong>Venue:</strong> ${ev.venue}</div>
        <div><strong>Coordinator:</strong> ${ev.coordinator || "-"}</div>
        <div class="mt-2"><strong>Description:</strong><div class="small muted">${
			ev.desc || "‚Äî"
		}</div></div>
      `;
				new bootstrap.Modal(
					document.getElementById("viewModal")
				).show();
			};

			window.editEvent = function (id) {
				const ev = events.find((e) => e.id === id);
				if (!ev) return;
				document.getElementById("eventModalTitle").textContent =
					"Edit Event";
				document.getElementById("evtId").value = ev.id;
				document.getElementById("evtName").value = ev.name;
				document.getElementById("evtVenue").value = ev.venue;
				// convert to local input format
				const dt = new Date(ev.date);
				document.getElementById("evtDate").value = dt
					.toISOString()
					.slice(0, 16);
				document.getElementById("evtCapacity").value = ev.capacity;
				document.getElementById("evtCoordinator").value =
					ev.coordinator;
				document.getElementById("evtDesc").value = ev.desc || "";
				new bootstrap.Modal(
					document.getElementById("eventModal")
				).show();
			};

			function promptDelete(id) {
				document.getElementById("confirmBody").textContent =
					"Delete " + id + "? This action cannot be undone.";
				new bootstrap.Modal(
					document.getElementById("confirmModal")
				).show();
				document.getElementById("confirmYes").onclick = () => {
					events = events.filter((e) => e.id !== id);
					bootstrap.Modal.getInstance(
						document.getElementById("confirmModal")
					).hide();
					renderTable();
				};
			}

			// bulk selection / actions
			document
				.getElementById("selectAll")
				.addEventListener("change", function () {
					document
						.querySelectorAll(".row-check")
						.forEach((cb) => (cb.checked = this.checked));
				});

			document
				.getElementById("bulkDeleteBtn")
				.addEventListener("click", function () {
					const ids = Array.from(
						document.querySelectorAll(".row-check:checked")
					).map((n) => n.dataset.id);
					if (ids.length === 0) return alert("Select rows first");
					if (!confirm("Delete " + ids.length + " events?")) return;
					events = events.filter((e) => !ids.includes(e.id));
					renderTable();
				});

			document
				.getElementById("bulkExportBtn")
				.addEventListener("click", function () {
					const ids = Array.from(
						document.querySelectorAll(".row-check:checked")
					).map((n) => n.dataset.id);
					const rows = events.filter((e) => ids.includes(e.id));
					if (rows.length === 0) return alert("Select rows first");
					exportCSV(rows, "events-selected.csv");
				});

			// export helper
			function exportCSV(rows, filename = "export.csv") {
				const cols = [
					"id",
					"name",
					"date",
					"venue",
					"capacity",
					"coordinator",
					"enrolled",
					"status",
					"desc",
				];
				const csv = [cols.join(",")]
					.concat(
						rows.map((r) =>
							cols
								.map(
									(c) =>
										`"${String(r[c] ?? "").replace(
											/"/g,
											'""'
										)}"`
								)
								.join(",")
						)
					)
					.join("\n");
				const blob = new Blob([csv], { type: "text/csv" });
				const url = URL.createObjectURL(blob);
				const a = document.createElement("a");
				a.href = url;
				a.download = filename;
				document.body.appendChild(a);
				a.click();
				a.remove();
				URL.revokeObjectURL(url);
			}

			// search/filter controls
			document
				.getElementById("tableSearch")
				.addEventListener("input", () => {
					page = 1;
					renderTable();
				});
			document
				.getElementById("clearSearch")
				.addEventListener("click", () => {
					document.getElementById("tableSearch").value = "";
					renderTable();
				});
			document
				.getElementById("filterStatus")
				.addEventListener("change", () => {
					page = 1;
					renderTable();
				});

			// global header search (optional)
			document
				.getElementById("globalSearch")
				.addEventListener("keyup", (e) => {
					if (e.key === "Enter") {
						document.getElementById("tableSearch").value =
							e.target.value;
						renderTable();
					}
				});

			// column sort
			document.querySelectorAll("th[data-sort]").forEach((th) => {
				th.style.cursor = "pointer";
				th.addEventListener("click", () => {
					const key = th.getAttribute("data-sort");
					if (sortKey === key)
						sortDir = sortDir === "asc" ? "desc" : "asc";
					else {
						sortKey = key;
						sortDir = "asc";
					}
					renderTable();
				});
			});

			// page init
			renderTable();
		</script>
	</body>
</html>
