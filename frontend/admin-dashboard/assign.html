<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Event Ease ‚Äî Assign Coordinators</title>

		<!-- Google Font: Inter -->
		<link
			href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
			rel="stylesheet"
		/>

		<!-- Bootstrap -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>

		<!-- Project stylesheet -->
		<link href="../style.css" rel="stylesheet" />

		<!-- Page-specific overrides -->
		<style>
			/* Event card header with gradient */
			.event-card-header {
				background: linear-gradient(
					135deg,
					var(--primary) 0%,
					#2563eb 100%
				);
				padding: 28px 32px;
				color: white;
				border-radius: var(--card-radius) var(--card-radius) 0 0;
				position: relative;
			}

			.event-card {
				border-radius: var(--card-radius);
				overflow: hidden;
				margin-bottom: var(--space-lg);
				border: 1px solid var(--border);
				box-shadow: var(--shadow-md);
			}

			.event-card-body {
				padding: 28px 32px;
			}

			.event-title {
				font-size: 1.5rem;
				font-weight: 700;
				margin-bottom: 8px;
			}

			.event-description {
				color: rgba(255, 255, 255, 0.95);
				margin-bottom: 0;
				line-height: 1.6;
			}

			/* Event ID Badge */
			.event-id-badge {
				position: absolute;
				top: 28px;
				right: 32px;
				background: rgba(255, 255, 255, 0.15);
				backdrop-filter: blur(10px);
				padding: 12px 20px;
				border-radius: 10px;
				border: 1px solid rgba(255, 255, 255, 0.25);
			}

			.event-id-label {
				font-size: 0.7rem;
				color: rgba(255, 255, 255, 0.8);
				text-transform: uppercase;
				letter-spacing: 0.5px;
				margin-bottom: 2px;
			}

			.event-id-value {
				font-size: 1.1rem;
				font-weight: 700;
				color: white;
			}

			/* Meta items */
			.event-meta {
				display: flex;
				gap: 16px;
				flex-wrap: wrap;
				margin-bottom: var(--space-lg);
			}

			.meta-item {
				display: inline-flex;
				align-items: center;
				gap: 8px;
				padding: 10px 16px;
				background: var(--bg-light);
				border-radius: 8px;
				font-size: 0.9rem;
				border: 1px solid var(--border);
			}

			.meta-label {
				font-weight: 600;
				color: var(--text-muted);
			}

			.meta-value {
				color: var(--text-dark);
			}

			/* Coordinator section */
			.coordinator-section {
				background: var(--bg-light);
				padding: 24px;
				border-radius: var(--radius-md);
				border: 2px dashed var(--border);
			}

			.section-label {
				font-weight: 600;
				color: var(--text-muted);
				font-size: 0.85rem;
				text-transform: uppercase;
				letter-spacing: 0.5px;
				margin-bottom: 12px;
			}

			.assigned-badge {
				display: inline-flex;
				align-items: center;
				gap: 8px;
				padding: 8px 16px;
				border-radius: 20px;
				font-size: 0.9rem;
				margin: 4px;
				background: var(--success);
				color: white;
				font-weight: 500;
				box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
			}

			.empty-state {
				color: var(--text-muted);
				font-style: italic;
			}

			/* Action buttons */
			.action-buttons {
				display: flex;
				gap: 12px;
				flex-wrap: wrap;
				margin-top: 16px;
			}

			/* Page header */
			.page-header {
				background: var(--bg-surface);
				padding: 24px 28px;
				border-radius: var(--card-radius);
				box-shadow: var(--shadow-sm);
				margin-bottom: var(--space-lg);
				border: 1px solid var(--border);
			}

			.page-title {
				font-size: 1.75rem;
				font-weight: 700;
				color: var(--text-dark);
				margin-bottom: 4px;
			}

			.page-subtitle {
				color: var(--text-muted);
				font-size: 0.95rem;
			}

			/* Participants card */
			.participants-card {
				background: var(--bg-surface);
				border-radius: var(--card-radius);
				box-shadow: var(--shadow-md);
				border: 1px solid var(--border);
				overflow: hidden;
				margin-bottom: var(--space-lg);
			}

			.participants-header {
				background: var(--bg-light);
				padding: 20px 28px;
				border-bottom: 1px solid var(--border);
			}

			.participants-body {
				padding: 28px;
			}

			/* Table enhancements */
			.table thead {
				background: linear-gradient(
					135deg,
					var(--primary) 0%,
					#2563eb 100%
				);
				color: white;
			}

			.table thead th {
				border: none;
				padding: 14px 16px;
				font-weight: 600;
				text-transform: uppercase;
				font-size: 0.8rem;
				letter-spacing: 0.5px;
			}

			.table tbody tr {
				transition: all 0.2s ease;
				border-bottom: 1px solid var(--border);
			}

			.table tbody tr:hover {
				background: var(--primary-light);
			}

			.table tbody td {
				padding: 14px 16px;
			}

			/* Modal enhancements */
			.modal-content {
				border-radius: 16px;
				border: none;
				box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
			}

			.modal-header {
				background: linear-gradient(
					135deg,
					var(--primary) 0%,
					#2563eb 100%
				);
				color: white;
				padding: 24px 28px;
				border-bottom: none;
				border-radius: 16px 16px 0 0;
			}

			.modal-title {
				font-weight: 700;
				font-size: 1.3rem;
			}

			.modal-body {
				padding: 28px;
			}

			.btn-close {
				filter: brightness(0) invert(1);
				opacity: 0.8;
			}

			/* Teacher list items */
			.teacher-item {
				padding: 16px;
				border-radius: 8px;
				margin-bottom: 8px;
				border: 1px solid var(--border);
				cursor: pointer;
				transition: all 0.2s ease;
				background: var(--bg-surface);
			}

			.teacher-item:hover {
				background: var(--primary-light);
				border-color: var(--primary);
				transform: translateX(4px);
			}

			.teacher-name {
				font-weight: 600;
				color: var(--text-dark);
				margin-bottom: 4px;
			}

			.teacher-details {
				color: var(--text-muted);
				font-size: 0.85rem;
			}

			#teacherList {
				max-height: 400px;
				overflow-y: auto;
				padding-right: 8px;
			}

			/* Selected container */
			.selected-container {
				background: var(--bg-light);
				border: 2px dashed var(--border);
				border-radius: var(--radius-md);
				padding: 20px;
				min-height: 200px;
			}

			.selected-item {
				background: var(--bg-surface);
				padding: 14px;
				border-radius: 8px;
				margin-bottom: 10px;
				border: 1px solid var(--border);
				box-shadow: var(--shadow-sm);
			}

			/* Pagination controls */
			.pagination-controls {
				display: flex;
				align-items: center;
				gap: 12px;
			}

			/* Responsive adjustments */
			@media (max-width: 991px) {
				.event-id-badge {
					position: static;
					margin-top: 16px;
					display: inline-block;
				}
			}
		</style>
	</head>

	<body>
		<!-- HEADER -->
		<header class="topbar">
			<a
				class="d-flex align-items-center text-decoration-none"
				href="admin.html"
				aria-label="Event Ease Home"
			>
				<div class="logo">
					<img src="../logo.svg" alt="EE" style="height: 36px" />
				</div>
				<div
					style="
						margin-left: 10px;
						font-weight: 700;
						color: var(--text-dark);
					"
				>
					Event Ease
				</div>
			</a>

			<div class="d-flex align-items-center gap-3">
				<div class="d-none d-md-block" style="min-width: 280px">
					<input
						id="globalSearch"
						class="form-control form-control-sm"
						placeholder="Search (events, users, IDs) ‚Äî /"
					/>
				</div>
				<a
					href="notifications.html"
					class="position-relative btn btn-light"
					title="Notifications"
				>
					üîî
					<span
						id="adminNotifCount"
						class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
						style="font-size: 11px"
					>
						2
					</span>
				</a>

				<div class="dropdown">
					<button
						class="btn d-flex align-items-center gap-2"
						data-bs-toggle="dropdown"
						aria-expanded="false"
					>
						<div
							class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
							style="width: 36px; height: 36px"
						>
							AD
						</div>
						<div class="d-none d-md-block text-start">
							<div style="font-weight: 600">Admin</div>
							<div class="text-muted" style="font-size: 0.85rem">
								admin@college.edu
							</div>
						</div>
					</button>
					<ul class="dropdown-menu dropdown-menu-end">
						<li>
							<a class="dropdown-item" href="profile.html"
								>Profile</a
							>
						</li>
						<li>
							<a class="dropdown-item" href="settings.html"
								>Settings</a
							>
						</li>
						<li><hr class="dropdown-divider" /></li>
						<li>
							<a
								class="dropdown-item text-danger"
								href="#"
								id="logoutBtn"
								>Logout</a
							>
						</li>
					</ul>
				</div>
			</div>
		</header>

		<div class="app-shell">
			<!-- SIDEBAR -->
			<aside
				class="app-sidebar d-none d-lg-flex"
				aria-label="Main navigation"
			>
				<nav class="sidebar-nav">
					<a class="active" href="admin.html">üè† Home</a>
					<a href="users.html">üë• Users</a>
					<a href="events.html">üìÖ Events</a>
					<a href="add-event.html">‚ûï Add Event</a>
					<a href="reports.html">üìä Reports</a>
					<a href="notifications.html">üîî Notifications</a>
					<a href="profile.html">üë§ Profile</a>
				</nav>

				<div class="sidebar-footer">
					<a
						id="logoutSide"
						class="text-danger"
						style="display: block; margin-bottom: 12px"
						>üîí Logout</a
					>
					v1.0 ‚Ä¢ ¬© <span id="year"></span>
				</div>
			</aside>

			<!-- MAIN -->
			<main class="app-main">
				<div style="max-width: 1200px; margin: 0 auto">
					<!-- Page Header -->
					<div
						class="page-header d-flex align-items-center justify-content-between flex-wrap"
						style="gap: 16px"
					>
						<div>
							<h1 class="page-title">
								Event Coordinator Assignment
							</h1>
							<p class="page-subtitle mb-0">
								Manage and assign coordinators for
								<strong id="eventTitleBreadcrumb"
									>this event</strong
								>
							</p>
						</div>
						<button id="backBtn" class="btn btn-outline">
							‚Üê Back to Events
						</button>
					</div>

					<!-- Event Card -->
					<div class="event-card">
						<div class="event-card-header position-relative">
							<div class="event-id-badge">
								<div class="event-id-label">Event ID</div>
								<div class="event-id-value" id="eventId">
									#EVT-000
								</div>
							</div>
							<h2 class="event-title" id="eventName">
								Event Title
							</h2>
							<p class="event-description" id="eventDesc">
								Event description goes here
							</p>
						</div>

						<div class="event-card-body">
							<div class="event-meta">
								<div class="meta-item">
									<span class="meta-label">Category:</span>
									<span class="meta-value" id="eventCategory"
										>Technical</span
									>
								</div>
								<div class="meta-item">
									<span class="meta-label">Type:</span>
									<span class="meta-value" id="eventType"
										>Free</span
									>
								</div>
								<div class="meta-item">
									<span class="meta-label">Date:</span>
									<span class="meta-value" id="eventWhen"
										>Jan 14, 2025</span
									>
								</div>
							</div>

							<div class="coordinator-section">
								<div class="section-label">
									Assigned Coordinators
								</div>
								<div id="coordinatorDisplay" class="mb-2">
									<span class="empty-state"
										>No coordinators assigned yet</span
									>
								</div>
								<div class="action-buttons">
									<button
										id="assignBtn"
										class="btn btn-primary"
									>
										‚úèÔ∏è Assign Coordinators
									</button>
									<button
										id="viewParticipantsBtn"
										class="btn btn-outline"
									>
										üë• View Participants
									</button>
								</div>
							</div>
						</div>
					</div>

					<!-- Participants Card -->
					<div
						id="participantsCard"
						class="participants-card"
						style="display: none"
					>
						<div
							class="participants-header d-flex justify-content-between align-items-center flex-wrap"
							style="gap: 12px"
						>
							<h5 class="mb-0 fw-bold">Event Participants</h5>
							<div class="d-flex gap-2 align-items-center">
								<span
									class="text-muted"
									style="font-size: 0.85rem"
									>Show</span
								>
								<select
									id="participantsPageSize"
									class="form-select form-select-sm"
									style="width: 80px"
								>
									<option value="5">5</option>
									<option value="10" selected>10</option>
									<option value="25">25</option>
								</select>
							</div>
						</div>

						<div class="participants-body">
							<div id="participantsTableContainer"></div>
							<div class="d-flex justify-content-end mt-3">
								<div
									id="participantsPagination"
									class="pagination-controls"
								></div>
							</div>
						</div>
					</div>

					<!-- Assign Modal -->
					<div
						class="modal fade"
						id="assignModal"
						tabindex="-1"
						aria-hidden="true"
					>
						<div
							class="modal-dialog modal-dialog-centered modal-lg"
						>
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title">
										Assign Event Coordinators
									</h5>
									<button
										type="button"
										class="btn-close"
										data-bs-dismiss="modal"
										aria-label="Close"
									></button>
								</div>

								<div class="modal-body">
									<div class="row">
										<div class="col-md-7 border-end pe-4">
											<div
												class="mb-3 d-flex gap-2 align-items-center flex-wrap"
											>
												<input
													id="teacherSearch"
													type="search"
													placeholder="üîç Search by name, email, or department"
													class="form-control flex-grow-1"
													style="min-width: 200px"
												/>
												<select
													id="pageSizeSelect"
													class="form-select"
													style="width: 120px"
												>
													<option value="5">
														5 / page
													</option>
													<option value="10" selected>
														10 / page
													</option>
													<option value="25">
														25 / page
													</option>
												</select>
											</div>

											<div id="teacherList"></div>

											<div
												class="d-flex justify-content-between align-items-center mt-3 flex-wrap"
												style="gap: 12px"
											>
												<div
													id="teacherCount"
													class="text-muted"
													style="font-size: 0.85rem"
												></div>
												<div
													class="pagination-controls"
												>
													<button
														id="prevPage"
														class="btn btn-sm btn-outline"
													>
														Prev
													</button>
													<div
														id="pageInfo"
														class="text-muted px-2"
														style="
															font-size: 0.85rem;
														"
													>
														Page 1
													</div>
													<button
														id="nextPage"
														class="btn btn-sm btn-outline"
													>
														Next
													</button>
												</div>
											</div>

											<div
												id="noTeachers"
												class="empty-state text-center p-3 d-none"
											>
												No teachers found
											</div>
										</div>

										<div class="col-md-5 ps-4">
											<div class="section-label mb-2">
												Selected Coordinators
											</div>
											<div
												id="selectedContainer"
												class="selected-container"
											>
												<div class="empty-state">
													No coordinators selected
												</div>
											</div>

											<div
												class="mt-3 d-flex justify-content-end gap-2"
											>
												<button
													class="btn btn-secondary"
													data-bs-dismiss="modal"
												>
													Cancel
												</button>
												<button
													id="confirmAssign"
													class="btn btn-primary"
													disabled
												>
													‚úì Assign Selected
												</button>
											</div>

											<hr class="my-3" />
											<div
												class="text-muted"
												style="font-size: 0.85rem"
											>
												<strong>Note:</strong> Only
												users with the
												<span class="badge bg-secondary"
													>teacher</span
												>
												role are displayed.
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</main>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

		<script>
			// -- MOCK data and UI wiring (kept unchanged) --
			const MOCK_EVENT = {
				id: "EVT-123",
				title: "Tech Innovator Summit",
				description: "A 1-day hackathon with workshops and talks.",
				category: "Technical",
				type: "Free",
				date: "2025-01-14",
				coordinators: [
					{
						id: "T1", // use a teacher id (from ALL_USERS) so checkbox matching works in modal
						name: "Rohan Sharma",
						email: "rohan@example.com",
						dept: "CSE",
					},
				],
			};

			const ALL_USERS = Array.from({ length: 200 }, (_, i) => ({
				id: "T" + (i + 1),
				name: "Teacher " + (i + 1),
				email: "teacher" + (i + 1) + "@example.com",
				role: "teacher",
				dept: ["CSE", "EE", "ME", "Design"][i % 4],
			}));

			const ALL_PARTICIPANTS = Array.from({ length: 37 }, (_, i) => ({
				id: "P" + (i + 1),
				name: "Participant " + (i + 1),
				email: "p" + (i + 1) + "@example.com",
			}));

			function apiFetchTeachers(page = 1, pageSize = 10, q = "") {
				return new Promise((resolve) => {
					setTimeout(() => {
						const start = (page - 1) * pageSize;
						const ql = String(q || "")
							.trim()
							.toLowerCase();
						let filtered = ALL_USERS;
						if (ql)
							filtered = ALL_USERS.filter((u) =>
								(u.name + u.email + u.dept)
									.toLowerCase()
									.includes(ql)
							);
						const items = filtered.slice(start, start + pageSize);
						resolve({ total: filtered.length, items });
					}, 150);
				});
			}

			// UI elements
			const assignModal = new bootstrap.Modal(
				document.getElementById("assignModal")
			);
			const teacherList = document.getElementById("teacherList");
			const teacherSearch = document.getElementById("teacherSearch");
			const selectedContainer =
				document.getElementById("selectedContainer");
			const confirmAssignBtn = document.getElementById("confirmAssign");
			const coordinatorDisplay =
				document.getElementById("coordinatorDisplay");
			const pageSizeSelect = document.getElementById("pageSizeSelect");
			const prevPageBtn = document.getElementById("prevPage");
			const nextPageBtn = document.getElementById("nextPage");
			const pageInfo = document.getElementById("pageInfo");
			const teacherCount = document.getElementById("teacherCount");

			const participantsCard =
				document.getElementById("participantsCard");
			const participantsContainer = document.getElementById(
				"participantsTableContainer"
			);
			const participantsPageSize = document.getElementById(
				"participantsPageSize"
			);
			const participantsPagination = document.getElementById(
				"participantsPagination"
			);

			let selectedMap = new Map();
			let currentPage = 1;
			let currentPageSize = Number(pageSizeSelect.value);
			let currentQuery = "";
			let currentTotal = 0;

			function renderEvent(event) {
				document.getElementById("eventId").innerText = event.id;
				// show breadcrumb/title where it exists
				const bc = document.getElementById("eventTitleBreadcrumb");
				if (bc) bc.innerText = event.title;
				document.getElementById("eventName").innerText = event.title;
				document.getElementById("eventDesc").innerText =
					event.description;
				document.getElementById("eventCategory").innerText =
					event.category;
				document.getElementById("eventType").innerText = event.type;
				document.getElementById("eventWhen").innerText = event.date;
				renderCoordinators(event.coordinators || []);
			}

			function renderCoordinators(list) {
				if (!list || !list.length) {
					coordinatorDisplay.innerHTML =
						'<span class="empty-state">No coordinators assigned yet</span>';
					return;
				}

				coordinatorDisplay.innerHTML = "";
				list.forEach((c) => {
					const span = document.createElement("span");
					span.className = "assigned-badge";
					// use a non-breaking space for separation and keep markup minimal
					span.innerHTML = `${escapeHtml(
						c.name
					)} <button class="btn-close btn-close-white ms-2 btn-sm remove-coord" aria-label="Remove"></button>`;
					const removeBtn = span.querySelector(".remove-coord");
					if (removeBtn) {
						removeBtn.addEventListener("click", () =>
							removeCoordinator(c.id)
						);
					}
					coordinatorDisplay.appendChild(span);
				});
			}

			function removeCoordinator(id) {
				MOCK_EVENT.coordinators = MOCK_EVENT.coordinators.filter(
					(c) => c.id !== id
				);
				renderEvent(MOCK_EVENT);
				showTemporaryMessage("Coordinator removed");
			}

			async function loadTeacherPage(page = 1, pageSize = 10, q = "") {
				teacherList.innerHTML =
					'<div class="text-center text-muted small py-3">Loading...</div>';
				const res = await apiFetchTeachers(page, pageSize, q);
				currentTotal = res.total;
				teacherCount.innerText = `${res.items.length} of ${res.total} teachers`;
				renderTeacherRows(res.items);
				pageInfo.innerText = `Page ${page} / ${Math.max(
					1,
					Math.ceil(res.total / pageSize)
				)}`;
				prevPageBtn.disabled = page <= 1;
				nextPageBtn.disabled = page >= Math.ceil(res.total / pageSize);
			}

			function renderTeacherRows(items) {
				teacherList.innerHTML = "";
				if (!items.length) {
					teacherList.innerHTML =
						'<div class="text-center text-muted small py-3">No teachers on this page</div>';
					return;
				}
				items.forEach((t) => {
					const row = document.createElement("div");
					row.className =
						"d-flex align-items-center justify-content-between p-2 teacher-item";
					// structure content
					row.innerHTML = `
            <div>
              <div class="fw-medium">${escapeHtml(t.name)}</div>
              <div class="text-muted small">${escapeHtml(
					t.email
				)} ‚Ä¢ ${escapeHtml(t.dept)}</div>
            </div>
            <div>
              <input type="checkbox" class="form-check-input select-checkbox" data-id="${
					t.id
				}" />
            </div>
          `;
					const cb = row.querySelector(".select-checkbox");
					cb.addEventListener("change", (e) => {
						if (e.target.checked) addSelected(t);
						else removeSelected(t.id);
					});

					// If user is already a coordinator for this event, pre-check and add to selection
					if (
						(MOCK_EVENT.coordinators || []).some(
							(c) => c.id === t.id
						)
					) {
						cb.checked = true;
						// ensure selectedMap has the user (avoid duplicates)
						if (!selectedMap.has(t.id)) selectedMap.set(t.id, t);
					}
					teacherList.appendChild(row);
				});
				// re-render selected panel to reflect any pre-selected items that were added above
				renderSelected();
			}

			function debounce(fn, wait = 300) {
				let t;
				return (...args) => {
					clearTimeout(t);
					t = setTimeout(() => fn(...args), wait);
				};
			}

			async function gotoPage(page) {
				currentPage = page;
				await loadTeacherPage(
					currentPage,
					currentPageSize,
					currentQuery
				);
			}

			teacherSearch.addEventListener(
				"input",
				debounce((e) => {
					currentQuery = e.target.value;
					currentPage = 1;
					loadTeacherPage(currentPage, currentPageSize, currentQuery);
				}, 400)
			);
			pageSizeSelect.addEventListener("change", () => {
				currentPageSize = Number(pageSizeSelect.value);
				currentPage = 1;
				loadTeacherPage(currentPage, currentPageSize, currentQuery);
			});
			prevPageBtn.addEventListener("click", () =>
				gotoPage(Math.max(1, currentPage - 1))
			);
			nextPageBtn.addEventListener("click", () =>
				gotoPage(currentPage + 1)
			);

			function addSelected(user) {
				if (!selectedMap.has(user.id)) selectedMap.set(user.id, user);
				renderSelected();
			}
			function removeSelected(id) {
				selectedMap.delete(id);
				renderSelected();
			}

			function renderSelected() {
				selectedContainer.innerHTML = "";
				if (!selectedMap.size) {
					selectedContainer.innerHTML =
						'<div class="empty-state">No coordinators selected</div>';
					confirmAssignBtn.disabled = true;
					return;
				}
				confirmAssignBtn.disabled = false;
				selectedMap.forEach((u) => {
					const div = document.createElement("div");
					div.className =
						"d-flex align-items-center justify-content-between mb-2 selected-item";
					div.innerHTML = `
            <div>
              <div class="fw-medium">${escapeHtml(u.name)}</div>
              <div class="text-muted small">${escapeHtml(u.email)}</div>
            </div>
            <div>
              <button class="btn btn-sm btn-outline-danger remove-selected">Remove</button>
            </div>
          `;
					div.querySelector(".remove-selected").addEventListener(
						"click",
						() => {
							// uncheck checkbox if present in the list
							const cb = teacherList.querySelector(
								`.select-checkbox[data-id="${u.id}"]`
							);
							if (cb) cb.checked = false;
							removeSelected(u.id);
						}
					);
					selectedContainer.appendChild(div);
				});
			}

			confirmAssignBtn.addEventListener("click", () => {
				const selected = Array.from(selectedMap.values());
				if (!selected.length) return;
				MOCK_EVENT.coordinators = selected.slice();
				renderEvent(MOCK_EVENT);
				assignModal.hide();
				showTemporaryMessage("Coordinators updated");
			});

			document
				.getElementById("assignBtn")
				.addEventListener("click", () => {
					// reset selection (we will preload any existing assigned ones during page load)
					selectedMap.clear();
					selectedContainer.innerHTML =
						'<div class="empty-state">No coordinators selected</div>';
					currentPage = 1;
					currentPageSize = Number(pageSizeSelect.value);
					currentQuery = "";
					teacherSearch.value = "";
					loadTeacherPage(currentPage, currentPageSize, currentQuery);
					assignModal.show();
				});

			// Participants inline table (shown only when admin clicks "View participants")
			let partPage = 1;
			function renderParticipantsTable(page = 1, pageSize = 10) {
				const start = (page - 1) * pageSize;
				const slice = ALL_PARTICIPANTS.slice(start, start + pageSize);
				const total = ALL_PARTICIPANTS.length;

				let html = `
          <div class="table-responsive">
            <table class="table table-sm table-hover">
              <thead>
                <tr><th>#</th><th>Name</th><th>Email</th><th>Actions</th></tr>
              </thead>
              <tbody>
        `;
				if (!slice.length)
					html += `<tr><td colspan=4 class="text-center text-muted small">No participants</td></tr>`;
				slice.forEach((p, idx) => {
					html += `<tr><td>${start + idx + 1}</td><td>${escapeHtml(
						p.name
					)}</td><td>${escapeHtml(
						p.email
					)}</td><td><button class="btn btn-sm btn-outline-secondary" onclick="viewParticipant('${
						p.id
					}')">View</button></td></tr>`;
				});
				html += `</tbody></table></div>`;
				participantsContainer.innerHTML = html;

				const totalPages = Math.max(1, Math.ceil(total / pageSize));
				participantsPagination.innerHTML = `
          <div class="text-muted small">${total} participants</div>
          <div class="pagination-controls"> <button class="btn btn-sm btn-outline-secondary" id="pprev">Prev</button> <div class="text-muted small px-2">Page ${page} / ${totalPages}</div> <button class="btn btn-sm btn-outline-secondary" id="pnext">Next</button> </div>
        `;
				document.getElementById("pprev").disabled = page <= 1;
				document.getElementById("pnext").disabled = page >= totalPages;
				document
					.getElementById("pprev")
					.addEventListener("click", () => {
						partPage = Math.max(1, partPage - 1);
						renderParticipantsTable(
							partPage,
							Number(participantsPageSize.value)
						);
					});
				document
					.getElementById("pnext")
					.addEventListener("click", () => {
						partPage = Math.min(totalPages, partPage + 1);
						renderParticipantsTable(
							partPage,
							Number(participantsPageSize.value)
						);
					});
			}

			participantsPageSize.addEventListener("change", () => {
				partPage = 1;
				renderParticipantsTable(
					partPage,
					Number(participantsPageSize.value)
				);
			});

			document
				.getElementById("viewParticipantsBtn")
				.addEventListener("click", () => {
					if (
						participantsCard.style.display === "none" ||
						participantsCard.style.display === ""
					) {
						participantsCard.style.display = "block";
						partPage = 1;
						renderParticipantsTable(
							partPage,
							Number(participantsPageSize.value)
						);
					} else {
						participantsCard.style.display = "none";
					}
				});

			function viewParticipant(id) {
				alert("Participant details: " + id);
			}

			function showTemporaryMessage(msg) {
				const el = document.createElement("div");
				el.className =
					"toast align-items-center text-white bg-success border-0";
				el.setAttribute("role", "alert");
				el.setAttribute("aria-live", "assertive");
				el.setAttribute("aria-atomic", "true");
				el.style.position = "fixed";
				el.style.right = "18px";
				el.style.bottom = "18px";
				el.innerHTML = `<div class='d-flex'><div class='toast-body'>${escapeHtml(
					msg
				)}</div><button type='button' class='btn-close btn-close-white ms-2 me-2' data-bs-dismiss='toast' aria-label="Close"></button></div>`;
				document.body.appendChild(el);
				const bs = new bootstrap.Toast(el, { delay: 2500 });
				bs.show();
				el.addEventListener("hidden.bs.toast", () => el.remove());
			}

			function escapeHtml(s) {
				return String(s)
					.replaceAll("&", "&amp;")
					.replaceAll("<", "&lt;")
					.replaceAll(">", "&gt;");
			}

			// init
			renderEvent(MOCK_EVENT);
			// set year in footer if present
			try {
				document.getElementById("year").innerText =
					new Date().getFullYear();
			} catch (e) {}
		</script>
	</body>
</html>
